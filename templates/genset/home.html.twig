{% extends 'base.html.twig' %}

{% block title %}Genset {{smartMod.name|capitalize}} Home{% endblock %}

{% block stylesheets %}
    {#{{ encore_entry_link_tags('app') }}#}
    <link href="/plugins/daterangepicker/daterangepicker.css" rel="stylesheet" />

    <!-- Sweet Alert -->
    <link href="/plugins/sweet-alert2/sweetalert2.min.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css">

    <!-- DataTables -->
    <link href="/plugins/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <link href="/plugins/datatables/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <!-- Responsive datatable examples -->
    <link href="/plugins/datatables/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" /> 
    

{% endblock %}
        
{% block breadcrumbItem %}
{# <li class="breadcrumb-item"><a href="javascript:void(0);">Metrica</a></li> #}
<li class="breadcrumb-item"><a href="javascript:void(0);">{{smartMod.name}}</a></li>
<li class="breadcrumb-item active">Home</li>
{% endblock %}

{% block pageTitle %}ST-DIGITAL Power Monitoring web portal{% endblock %}

{% block body %}
{# <div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body"> #}

                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#engine" role="tab">Engine parameters</a>
                    </li>                                                
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#gen" role="tab">Generator parameters</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#energy" role="tab">Energy</a>
                    </li>                                                
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#alarm" role="tab">Alarm status</a>
                    </li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                    <div class="tab-pane p-3" id="gen" role="tabpanel">
                        <div class="row">
                            <div class="col-sm-8 col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="wallet-bal-usd">
                                                    <h3 class="text-center">Generator</h3>
                                                </div> 
                                                
                                                <div class="text-center"> 
                                                    <span class="badge badge-success mr-2 h6" id="gensetStatus"><h6>Running</h6></span>
                                                    <span class="badge badge-success" id="cg"><h6>CG <span>Closed</span> </h6></span>
                                                </div>
                                            </div>                                        
                                        </div>                                               
                                    </div><!--end card-body-->
                                    <div class="card-body pt-0">
                                        <ul class="list-group wallet-bal-crypto">
                                            <li class="list-group-item align-items-center d-flex justify-content-between">
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">L1-L2</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-success" id="l1l2"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">L1-L3</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-pink" id="l1l3"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">L2-L3</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-primary" id="l2l3"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                            </li>

                                            <li class="list-group-item align-items-center d-flex justify-content-between">
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">L1-N</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-success" id="l1N"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">L2-N</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-pink" id="l2N"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">L3-N</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-primary" id="l3N"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                            </li>

                                            <li class="list-group-item align-items-center d-flex justify-content-between">
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">I1</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-success" id="I1"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">I2</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-pink" id="I2"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">I3</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-primary" id="I3"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                            </li>

                                            <li class="list-group-item align-items-center d-flex justify-content-between">
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">Active Power</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-success" id="activePower"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">Reactive Power</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-pink" id="reactivePower"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">Apparent Power</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-primary" id="apparentPower"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                            </li>

                                            <li class="list-group-item align-items-center d-flex justify-content-between">
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">CosPhi</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-success" id="cosfi"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">Frequency</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-pink" id="freq"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal ">                                                        
                                                            <h3 class="m-0">Leak current</h3>
                                                            <p class="text-muted  mb-0"><h4><span class="badge badge-soft-primary" id="idiff"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                            </li>
                                                                        
                                        </ul> 
                                    </div><!--end card-body--> 
                                </div><!--end card--> 
                            </div><!--end col-->

                            <div class="col-sm-4 col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="wallet-bal-usd">
                                                    <h3 class="text-center">Mains</h3>
                                                </div> 
                                                
                                                <div class="text-center"> 
                                                    <span class="badge badge-danger mr-2" id="mainsStatus"><h6>Absent</h6></span>
                                                    <span class="badge badge-danger" id="cr"><h6>CR <span>open</span> </h6></span>
                                                </div>
                                            </div>                                        
                                        </div>                                               
                                    </div><!--end card-body-->
                                    <div class="card-body pt-0">
                                        <ul class="list-group wallet-bal-crypto">
                                            <li class="list-group-item align-items-center d-flex justify-content-between">
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">L1-L2</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-success" id="l1l2M"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">L1-L3</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-pink" id="l1l3M"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                                <div class="media">
                                                    <div class="media-body text-center"> 
                                                        <div class="coin-bal">                                                        
                                                            <h3 class="m-0">L2-L3</h3>
                                                            <p class="text-muted mb-0"><h4><span class="badge badge-soft-primary" id="l2l3M"></span></h4></p>
                                                        </div>                                                                                              
                                                    </div><!--end media body-->
                                                </div>
                                            </li>
                                                                
                                        </ul> 
                                    </div><!--end card-body--> 
                                </div><!--end card--> 
                            </div><!--end col-->

                        </div>
                    </div>

                    <div class="tab-pane active p-3" id="engine" role="tabpanel">
                        <div class="row">
                            <div class="col-sm-4 col-12">
                                <div class="card">
                                    <div class="card-body "> 
                                        <p class="text-muted mb-3"></p>
                                        <div id="fuel_level" class="gauge text-center"></div>
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                            <div class="col-sm-4 col-12">
                                <div class="card">
                                    <div class="card-body"> 
                                        <p class="text-muted mb-3"></p>
                                        <div id="oil_level" class="gauge"></div>
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                            <div class="col-sm-4 col-12">
                                <div class="card">
                                    <div class="card-body"> 
                                        <p class="text-muted mb-3"></p>
                                        <div id="water_level" class="gauge"></div>
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                        </div><!--end row-->

                        <div class="row">
                            <div class="col-sm-4 col-12">
                                <div class="card">
                                    <div class="card-body "> 
                                        <p class="text-muted mb-3"></p>
                                        <div id="air_pressure" class="gauge text-center"></div>
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                            <div class="col-sm-4 col-12">
                                <div class="card">
                                    <div class="card-body"> 
                                        <p class="text-muted mb-3"></p>
                                        <div id="oil_pressure" class="gauge"></div>
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                            <div class="col-sm-4 col-12">
                                <div class="card">
                                    <div class="card-body"> 
                                        <p class="text-muted mb-3"></p>
                                        <div id="water_temp" class="gauge"></div>
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                        </div><!--end row-->

                        <div class="row">
                            <div class="col-sm-4 col-12">
                                <div class="card">
                                    <div class="card-body "> 
                                        <p class="text-muted mb-3"></p>
                                        <div id="cooler_temp" class="gauge text-center"></div>
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                            <div class="col-sm-4 col-12">
                                <div class="card">
                                    <div class="card-body"> 
                                        <p class="text-muted mb-3"></p>
                                        <div id="engine_speed" class="gauge"></div>
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                            <div class="col-sm-4 col-12">
                                <div class="card">
                                    <div class="card-body"> 
                                        <p class="text-muted mb-3"></p>
                                        <div id="batt_voltage" class="gauge"></div>
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                        </div><!--end row-->
                        
                        <div class="row float-right">
                            <small>Last update <span id="update">2021-07-15 15:45:52</span></small>
                        </div>
                    </div>       

                    <div class="tab-pane p-3" id="energy" role="tabpanel">
                        <div class="row">
                            {# <h5 class="mt-0 mb-3 "><a href="#" id="histo" class="text-decoration"><u>Consult History</u> <i class="dripicons-arrow-up"></i></a></h5> #}
                            <h5 class="mt-0 mb-3 d-none"><a href="#" id="home" class="text-decoration"><u>Back</u></a></h5>
                        </div>

                        <div class="row rowHisto d-none">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
        
                                        <h4 class="mt-0 header-title">History of the last 12 months</h4>
                                        
                                        <table id="datatable-buttons" class="table table-striped table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr class="text-center">
                                                    <th>Months</th>
                                                    <th>Running Time</th>
                                                    <th>Fuel consummed</th>
                                                    <th>Energy produced</th>
                                                    <th>PoE</th>
                                                </tr>
                                            </thead>
        
        
                                            <tbody>
                                                <tr>
                                                    <th>Jan-2020</th>
                                                    <td class="text-center">7500</td>
                                                    <td class="text-center">11</td>
                                                    <td class="text-center">5</td>
                                                    <td class="text-center">20</td>
                                                </tr>
                                                <tr>
                                                    <th>Fév-2020</th>
                                                    <td class="text-center">5500</td>
                                                    <td class="text-center">8</td>
                                                    <td class="text-center">3</td>
                                                    <td class="text-center">20</td>
                                                </tr>
                                                <tr>
                                                    <th>Mars-2020</th>
                                                    <td class="text-center">6800</td>
                                                    <td class="text-center">10</td>
                                                    <td class="text-center">4</td>
                                                    <td class="text-center">20</td>
                                                </tr>
                                                <tr>
                                                    <th>Avr-2020</th>
                                                    <td class="text-center">7200</td>
                                                    <td class="text-center">10.5</td>
                                                    <td class="text-center">3</td>
                                                    <td class="text-center">20</td>
                                                </tr>
                                                <tr>
                                                    <th>Mai-2020</th>
                                                    <td class="text-center">7600</td>
                                                    <td class="text-center">11.5</td>
                                                    <td class="text-center">5</td>
                                                    <td class="text-center">20</td>
                                                </tr>
                                                <tr>
                                                    <th>Juin-2020</th>
                                                    <td class="text-center">7100</td>
                                                    <td class="text-center">9.5</td>
                                                    <td class="text-center">3</td>
                                                    <td class="text-center">20</td>
                                                </tr>
                                                <tr>
                                                    <th>Juil-2020</th>
                                                    <td class="text-center">6500</td>
                                                    <td class="text-center">8.25</td>
                                                    <td class="text-center">2.5</td>
                                                    <td class="text-center">20</td>
                                                </tr>
                                                <tr>
                                                    <th>Août-2020</th>
                                                    <td class="text-center">7000</td>
                                                    <td class="text-center">10.75</td>
                                                    <td class="text-center">4</td>
                                                    <td class="text-center">20</td>
                                                </tr>
                                            </tbody>
                                        </table>        
                                    </div>
                                </div>
                            </div> <!-- end col -->
                        </div> <!-- end row -->

                        <div class="row home">
                            <div class="col-lg-6">
                                <div class="card card-eco">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <h4 class="title-text mt-0">Running time</h4>
                                            <i class="dripicons-clock card-eco-icon text-pink align-self-center"></i>
                                        </div>                                     
                                        <p><h5 class="font-weight-bold">This day : <span class="mr-2" id="trhd"></span> h</h5></p>
                                        <p><h5 class="font-weight-bold">This month : <span class="mr-2" id="trhm"></span> h</h5></p>
                                        <p><h5 class="font-weight-bold">This year : <span class="mr-2" id="trhy"></span> h</h5></p>
                                        <br/>
                                        {# <p><h4 class="font-weight-bold">Total : <span class="mr-2" id="trh"></span> h</h4></p> #}
                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div>
                            <div class="col-lg-6">
                                <div class="card card-eco">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <h4 class="title-text mt-0">Fuel Consumption</h4>
                                            <i class="dripicons-meter card-eco-icon text-info align-self-center"></i>
                                        </div>                                     
                                        <p><h5 class="font-weight-bold">This day : <span class="mr-2" id="fcd">0</span> L |<span class="ml-2" id="fcdp">0</span> {{smartMod.site.currency}} </h5></p>
                                        <p><h5 class="font-weight-bold">This month : <span class="mr-2" id="fcm">0</span> L |<span class="ml-2" id="fcmp">0</span> {{smartMod.site.currency}} </h5></p>
                                        <p><h5 class="font-weight-bold">This year : <span class="mr-2" id="fcy">0</span> L |<span class="ml-2" id="fcyp">0</span> {{smartMod.site.currency}} </h5></p>
                                        <br/>
                                        {# <p><h4 class="font-weight-bold">Total : <span class="mr-2" id="fc"></span> L</h4></p> #}
                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div>                  
                        
                        </div>

                        <div class="row home">
                            <div class="col-lg-6">
                                <div class="card card-eco">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <h4 class="title-text mt-0">Energy produced</h4>
                                            <i class="dripicons-graph-line card-eco-icon text-primary align-self-center"></i>
                                        </div>                                     
                                        <p><h5 class="font-weight-bold">This day : <span class="mr-2" id="tepd"></span> kWh</h5></p>
                                        <p><h5 class="font-weight-bold">This month : <span class="mr-2" id="tepm"></span> kWh</h5></p>
                                        <p><h5 class="font-weight-bold">This year : <span class="mr-2" id="tepy"></span> kWh</h5></p>
                                        <br/>
                                        {# <p><h4 class="font-weight-bold">Total : <span class="mr-2" id="tep"></span> kWh</h4></p> #}
                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div>

                            <div class="col-lg-6">
                                <div class="card card-eco">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <h4 class="title-text mt-0">Power Of Effectiveness (PoE)</h4>
                                            {# <i class="dripicons-graph-line card-eco-icon text-primary align-self-center"></i> #}
                                            <div class="data-icon">
                                                <i class="mdi mdi-spa rounded-circle bg-soft-primary"></i>
                                            </div>
                                        </div>                                     
                                        <p><h5 class="font-weight-bold">This day : <span class="mr-2" id="poed">0</span>|<span class="ml-2" id="poedProgVal">0</span> %<span><i class="mdi mdi-menu-down mdi-24px text-danger" id="poedProg"></i></span></h5></p>
                                        <p><h5 class="font-weight-bold">This month : <span class="mr-2" id="poem">0</span>|<span class="ml-2" id="poemProgVal">0</span> %<span><i class="mdi mdi-menu-down mdi-24px text-danger" id="poemProg"></i></span></h5></p>
                                        <p><h5 class="font-weight-bold">This year : <span class="mr-2" id="poey">0</span>|<span class="ml-2" id="poeyProgVal">0</span> %<span><i class="mdi mdi-menu-down mdi-24px text-danger" id="poeyProg"></i></span></h5></p>
                                        {# <p><h4 class="font-weight-bold">Total : <span class="mr-2" id="tep"></span> kWh</h4></p> #}
                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div>
                        </div>

                        <div class="row home">
                            <div class="col-12">
                                <label class="my-3">Pick Date Ranges</label>
                                <div class="input-group mb-3">  
                                    <input type="text" id="daterange" class="form-control" value="10/24/1984">
                                    <div class="input-group-append">
                                        <span class="input-group-text"><i class="dripicons-calendar"></i></span>
                                    </div>
                                </div>
                                {# <div class="input-group mb-3">                                            
                                    <input type="text" class="form-control" id="date"  value="01/01/2021">
                                    <div class="input-group-append">
                                        <span class="input-group-text"><i class="dripicons-calendar"></i></span>
                                    </div>
                                </div> #}

                                {# <div class="form-group ">
                                    <label for="example-input2-group1">Pick Date</label>
                                    <div class='input-group date' id='datetimepicker10'>
                                        <input type='text' class="form-control" id="example-input2-group1"/>
                                        <span class="input-group-append input-group-addon">
                                            <span class="input-group-text far fa-calendar-alt"></span>
                                        </span>
                                    </div>
                                </div> #}
                            </div>
                        </div>

                        <div class="row home">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mt-0 mb-4"></h4>
                                        <div class="chart-demo">
                                            <div id="apex_mixed1" class="apex-charts"></div>
                                        </div>                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->                            
                        </div><!--end row-->
                        {# <div class="row">
                            
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mt-0 mb-4">Column Chart with Datalabels</h4>
                                        <div class="chart-demo">
                                            <div id="apex_column2" class="apex-charts"></div>
                                        </div>                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->    
                        </div> #}

                        {# <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mt-0 mb-4">Zoomable Timeseries</h4>
                                        <div class="chart-demo">
                                            <div id="apex_line3" class="apex-charts"></div>
                                        </div>                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                        </div><!--end row--> #}

                        <div class="row home">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mt-0 mb-4"></h4>
                                        <div class="chart-demo">
                                            <div id="apex_mixed2" class="apex-charts"></div>
                                        </div>                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                        </div><!--end row-->
                        
                    </div>

                    <div class="tab-pane p-3" id="alarm" role="tabpanel">
                        
                        <div class="row">
                            <div class="col-sm-4 col-12">
                                <div class="card">
                                    <div class="card-body"> 
                                        <div class="table-responsive mt-4">
                                            <table class="table mb-0">
                                                <thead class="thead-light">
                                                <tr>
                                                    <th>Alarm</th>
                                                    <th class="text-center">Status</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <th scope="row">Low fuel</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="lowFuel"></i> </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Presence of water in fuel</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="presenceWaterInFuel"></i></td>                                              
                                                </tr>
                                                <tr>
                                                    <th scope="row">Overspeed</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="overspeed"></i></td>
                                                </tr>
                                                {# <tr>
                                                    <th scope="row">Engine running</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id=""></i></td>
                                                </tr> #}
                                                <tr>
                                                    <th scope="row">Maximum frequency</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="maxFreq"></i></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Minimum frequency</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="minFreq"></i></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Maximum voltage</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="maxVolt"></i></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Minimum voltage</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="minVolt"></i></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Max battery voltage</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="maxBattVolt"></i></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Min battery voltage</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="minBattVolt"></i></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Short-circuit</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="shortCircuit"></i></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Maintenance request</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="maintenanceRequest"></i></td>
                                                </tr>
                                                {# <tr>
                                                    <th scope="row">Switching status on genset</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id=""></i></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Switching status on mains</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id=""></i></td>
                                                </tr> #}
                                                <tr>
                                                    <th scope="row">Differential intervention</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="differentialIntervention"></i></td>
                                                </tr>
                                                {# <tr>
                                                    <th scope="row">Mains voltage presence</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id=""></i></td>
                                                </tr> #}
                                                <tr>
                                                    <th scope="row">Incorrect phases-mains sequence</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="mainsIncSeq"></i></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Incorrect phases-genset sequence</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="genIncSeq"></i></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Overload</th>
                                                    <td class="text-center"><i class="fas fa-circle text-danger" id="overload"></i></td>
                                                </tr>
                                                
                                                </tbody>
                                            </table><!--end /table-->
                                        </div>
                                        <div class="row mt-3">
                                            <span class="mr-4 text-center"><i class="fas fa-circle text-danger mr-2"></i>OFF</span><span class="text-center"><i class="fas fa-circle text-success mr-2"></i>ON </span>
                                        </div>
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div>

                            <div class="col-sm-8 col-12">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="card report-card">
                                            <div class="card-body">
                                                <div class="float-right">
                                                    <i class="dripicons-clock report-main-icon"></i>
                                                </div> 
                                                <span class="badge badge-soft-secondary">Hours to Maintenance</span>
                                                <h3 class="my-3"><span id="htm"></span> h</h3>
                                                
                                            </div><!--end card-body--> 
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="wallet-bal-usd">
                                                            <h3 class="text-center">This day</h3>
                                                        </div>
                                                    </div>                                        
                                                </div>                                               
                                            </div><!--end card-body-->
                                            <div class="card-body pt-0">
                                                <ul class="list-group wallet-bal-crypto">
                                                    <li class="list-group-item align-items-center d-flex justify-content-between">
                                                        <div class="media">
                                                            <div class="media-body text-center"> 
                                                                <div class="coin-bal">                                                        
                                                                    <h3 class="m-0">Performed start-ups</h3>
                                                                    <p class="text-muted mb-0"><h2><span class="badge badge-soft-success" id="npsd"></span></h2></p>
                                                                </div>                                                                                              
                                                            </div><!--end media body-->
                                                        </div>
                                                        <div class="media">
                                                            <div class="media-body text-center"> 
                                                                <div class="coin-bal">                                                        
                                                                    <h3 class="m-0">Mains interruptions</h3>
                                                                    <p class="text-muted mb-0"><h2><span class="badge badge-soft-pink" id="nmid"></span></h2></p>
                                                                </div>                                                                                              
                                                            </div><!--end media body-->
                                                        </div>
                                                    </li>
                                                                        
                                                </ul> 
                                            </div><!--end card-body--> 
                                        </div><!--end card--> 
                                    </div>

                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="wallet-bal-usd">
                                                            <h3 class="text-center">This month</h3>
                                                        </div>
                                                    </div>                                        
                                                </div>                                               
                                            </div><!--end card-body-->
                                            <div class="card-body pt-0">
                                                <ul class="list-group wallet-bal-crypto">
                                                    <li class="list-group-item align-items-center d-flex justify-content-between">
                                                        <div class="media">
                                                            <div class="media-body text-center"> 
                                                                <div class="coin-bal">                                                        
                                                                    <h3 class="m-0">Performed start-ups</h3>
                                                                    <p class="text-muted mb-0"><h2><span class="badge badge-soft-success" id="npsm"></span></h2></p>
                                                                </div>                                                                                              
                                                            </div><!--end media body-->
                                                        </div>
                                                        <div class="media">
                                                            <div class="media-body text-center"> 
                                                                <div class="coin-bal">                                                        
                                                                    <h3 class="m-0">Mains interruptions</h3>
                                                                    <p class="text-muted mb-0"><h2><span class="badge badge-soft-pink" id="nmim"></span></h2></p>
                                                                </div>                                                                                              
                                                            </div><!--end media body-->
                                                        </div>
                                                    </li>
                                                                        
                                                </ul> 
                                            </div><!--end card-body--> 
                                        </div><!--end card-->
                                    </div>

                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="wallet-bal-usd">
                                                            <h3 class="text-center">This year</h3>
                                                        </div>
                                                    </div>                                        
                                                </div>                                               
                                            </div><!--end card-body-->
                                            <div class="card-body pt-0">
                                                <ul class="list-group wallet-bal-crypto">
                                                    <li class="list-group-item align-items-center d-flex justify-content-between">
                                                        <div class="media">
                                                            <div class="media-body text-center"> 
                                                                <div class="coin-bal">                                                        
                                                                    <h3 class="m-0">Performed start-ups</h3>
                                                                    <p class="text-muted mb-0"><h2><span class="badge badge-soft-success" id="npsy"></span></h2></p>
                                                                </div>                                                                                              
                                                            </div><!--end media body-->
                                                        </div>
                                                        <div class="media">
                                                            <div class="media-body text-center"> 
                                                                <div class="coin-bal">                                                        
                                                                    <h3 class="m-0">Mains interruptions</h3>
                                                                    <p class="text-muted mb-0"><h2><span class="badge badge-soft-pink" id="nmiy"></span></h2></p>
                                                                </div>                                                                                              
                                                            </div><!--end media body-->
                                                        </div>
                                                    </li>
                                                                        
                                                </ul> 
                                            </div><!--end card-body--> 
                                        </div><!--end card-->
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>                                                
                                
                </div>        

        {# </div><!--end card-body-->
    </div><!--end card-->
</div><!--end col--> #}

{% endblock %}

{% block javascripts %}
    <script src="/plugins/justgage/justgage.js"></script>
    <script src="/plugins/justgage/raphael-2.1.4.min.js"></script>
    {# <script src="/pages/jquery.justgage.init.js"></script> #}
    {#{{ encore_entry_script_tags('app') }}#}

    <script src="/plugins/moment/moment.js"></script>
    <script src="/plugins/daterangepicker/daterangepicker.js"></script>
    <!--  bootstrap-datetimepicker -->
    <script src="/js/bootstrap-datetimepicker.min.js"></script>
        
    <script src="/pages/jquery.forms-advanced.js"> </script>

    <script src="/plugins/apexcharts/apexcharts.min.js"></script>
    <script src="https://apexcharts.com/samples/assets/irregular-data-series.js"></script>
    <script src="https://apexcharts.com/samples/assets/ohlc.js"></script>
    {# <script src="/pages/jquery.apexcharts.init.js"></script> #}

    <!-- Sweet-Alert  -->
    <script src="/plugins/sweet-alert2/sweetalert2.min.js"></script>

    <!-- Required datatable js -->
    <script src="/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="/plugins/datatables/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="/plugins/datatables/dataTables.buttons.min.js"></script>
    <script src="/plugins/datatables/buttons.bootstrap4.min.js"></script>
    <script src="/plugins/datatables/jszip.min.js"></script>
    <script src="/plugins/datatables/pdfmake.min.js"></script>
    <script src="/plugins/datatables/vfs_fonts.js"></script>
    <script src="/plugins/datatables/buttons.html5.min.js"></script>
    <script src="/plugins/datatables/buttons.print.min.js"></script>
    <script src="/plugins/datatables/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="/plugins/datatables/dataTables.responsive.min.js"></script>
    <script src="/plugins/datatables/responsive.bootstrap4.min.js"></script>
    <script src="/js/mqttws31.js" type="text/javascript"></script>
    <script>
        /*var print_first = pipe('#first', function(data) {
            message = new Paho.MQTT.Message(data);
            //message.destinationName = "test/all";
            message.destinationName = "to/device/esp/3164842";
            console.log("SEND ON " + message.destinationName + " PAYLOAD " + data);
            client.send(message);
        });*/

        var isConnected = false;
        var wsbroker = "192.168.10.40";//location.hostname;  //mqtt websocket enabled broker
        var wsport = 15675; // port for above 1883

        var client = new Paho.MQTT.Client(wsbroker, wsport, "/ws", "user_{{app.user.id}}");

        client.onConnectionLost = function (responseObject) {
            isConnected = false;
            console.log("CONNECTION LOST - " + responseObject.errorMessage);
        };

        client.onMessageArrived = function (message) {
            console.log("RECEIVE ON " + message.destinationName + " PAYLOAD " + message.payloadString);
            //print_first(message.payloadString);
            var result;
            var parse = true;
            try {
                result = JSON.parse(message.payloadString);
            } catch (e) {
                parse = false;
                console.error("Parsing error:", e);
            }

            if(parse){
                if (result.hasOwnProperty("L1")) {
                    //Mise à jour des jauges des données mécaniques
                    fuel_level.refresh( parseFloat(result.FL) ?? 0);
                    oil_level.refresh( parseFloat(result.OL) ?? 0);
                    water_level.refresh( parseFloat(result.WL) ?? 0);
                    air_pressure.refresh( parseFloat(result.AP) ?? 0);
                    oil_pressure.refresh( parseFloat(result.OP) ?? 0);
                    water_temp.refresh( parseFloat(result.WT) ?? 0);
                    cooler_temp.refresh( parseFloat(result.CT) ?? 0);
                    engine_speed.refresh( parseFloat(result.ESD) ?? 0);
                    batt_voltage.refresh( parseFloat(result.BV) ?? 0);

                    //Mise à jour des paramètres du générateur
                    $('#l1l2').text(String(result.L12 + " V"))
                    $('#l1l3').text(String(result.L13 + " V"))
                    $('#l2l3').text(String(result.L23 + " V"))
                    $('#l1N').text(String(result.L1 + " V"))
                    $('#l2N').text(String(result.L2 + " V"))
                    $('#l3N').text(String(result.L3 + " V"))
                    $('#l1l2M').text(String(result.L12M + " V"))
                    $('#l1l3M').text(String(result.L13M + " V"))
                    $('#l2l3M').text(String(result.L23M + " V"))
                    $('#I1').text(String(result.I1 + " A"))
                    $('#I2').text(String(result.I2 + " A"))
                    $('#I3').text(String(result.I1 + " A"))
                    $('#idiff').text(String(result.Id + " mA"))   
                    $('#freq').text(String(result.Fr + " Hz"))
                    $('#htm').text(String(result.HTM))  
                }

                if (result.hasOwnProperty("PWF")) {
                    $('#update').text(String(result.date1))
                    //$('#update').text(String( moment( new Date(result.date1) ).format("DD MMM YYYY HH:mm:ss")) )
                    if(parseInt(result.CG)){//CG = 1
                        $('#cg').removeClass('badge-danger')
                        $('#cg').addClass('badge-success')
                        $('#cg').children("h6").children("span").text('Closed')
                        //$('#cgStatus').text('Closed')
                        
                    }
                    else{//CG = 0
                        $('#cg').removeClass('badge-success')
                        $('#cg').addClass('badge-danger')
                        $('#cg').children("h6").children("span").text('Open')
                        //$('#cgStatus').text('Open')
                        
                    }      

                    if(parseInt(result.GenRun)){//Genset running = 1
                        $('#gensetStatus').removeClass('badge-danger')
                        $('#gensetStatus').addClass('badge-success')
                        $('#gensetStatus').children("h6").text('Running')
                    }
                    else{
                        $('#gensetStatus').removeClass('badge-success')
                        $('#gensetStatus').addClass('badge-danger')
                        $('#gensetStatus').children("h6").text('Stop')
                    }

                    
                    if(parseInt(result.CR)){//CR = 1
                        $('#cr').removeClass('badge-danger')
                        $('#cr').addClass('badge-success')
                        $('#cr').children("h6").children("span").text('Closed')
                        //$('#crStatus').text('Closed')
                        
                    }
                    else{//CR = 0
                        $('#cr').removeClass('badge-success')
                        $('#cr').addClass('badge-danger')
                        $('#cr').children("h6").children("span").text('Open')
                        //$('#crStatus').text('Open')
                        
                    }     

                    if(parseInt(result.MainsPresence)){//Mains Presence = 1
                        $('#mainsStatus').removeClass('badge-danger')
                        $('#mainsStatus').addClass('badge-success')
                        $('#mainsStatus').children("h6").text('Present')
                    }
                    else{
                        $('#mainsStatus').removeClass('badge-success')
                        $('#mainsStatus').addClass('badge-danger')
                        $('#mainsStatus').children("h6").text('Absent')
                    }        
                        
                    updateAlarmStatus($('#lowFuel'), parseInt(result.LowFuel))
                    updateAlarmStatus($('#presenceWaterInFuel'), parseInt(result.PWF))
                    updateAlarmStatus($('#overspeed'), parseInt(result.Overspeed))
                    updateAlarmStatus($('#maxFreq'), parseInt(result.MaxFr))
                    updateAlarmStatus($('#minFreq'), parseInt(result.MinFr))
                    updateAlarmStatus($('#maxVolt'), parseInt(result.MaxVolt))
                    updateAlarmStatus($('#minVolt'), parseInt(result.MinVolt))
                    updateAlarmStatus($('#maxBattVolt'), parseInt(result.MaxBV))
                    updateAlarmStatus($('#minBattVolt'), parseInt(result.MinBV))
                    updateAlarmStatus($('#shortCircuit'), parseInt(result.SC))
                    updateAlarmStatus($('#maintenanceRequest'), parseInt(result.MRqst))
                    updateAlarmStatus($('#differentialIntervention'), parseInt(result.DIT))
                    updateAlarmStatus($('#mainsIncSeq'), parseInt(result.MIS))
                    updateAlarmStatus($('#genIncSeq'), parseInt(result.GIS))
                    updateAlarmStatus($('#overload'), parseInt(result.Overload))
                }
            }
        };

        {# var options = {
            timeout: 3,
            keepAliveInterval: 30,
			userName: "mqtt-ESP-device",//"mqtt-test",
			password: "mqtt-ESP-device",//"mqtt-test",
            onSuccess: function () {
                isConnected = true;
                console.log("CONNECTION SUCCESS");
                client.subscribe("test/all", {qos: 1});
				client.subscribe("from/device/esp/{{smartMod.moduleId}}", {qos: 1});
            },
            onFailure: function (message) {
                console.log("CONNECTION FAILURE - " + message.errorMessage);
            }
        }; #}

        var options = {
            timeout: 3,
            keepAliveInterval: 30,
            userName: "mqtt-ESP-device",
            password: "mqtt-ESP-device",
            onSuccess: function () {
                isConnected = true;
                console.log("CONNECTION SUCCESS");
                client.subscribe("test/all", {qos: 1});
                client.subscribe("from/device/esp/#", {qos: 1});
            },
            onFailure: function (message) {
                console.log("CONNECTION FAILURE - " + message.errorMessage);
            }
        };

        if (location.protocol == "https:") {
            options.useSSL = true;
        }
        console.log("CONNECT TO " + wsbroker + ":" + wsport);
        client.connect(options);
        // Try to reconnect after a few seconds
        setInterval(function () {
            if(isConnected === false){
                console.log("CONNECT TO " + wsbroker + ":" + wsport);
                client.connect(options);
            }
            else{

            } 
        }, 2000);
    </script>

    <script>
        //Buttons examples
        var table = $('#datatable-buttons').DataTable({
            //sDom: 'lrtip',
            searching: false, 
            paging: false, 
            info: false,
            ordering: false,
            lengthChange: false,
            //buttons: ['copy', 'excel', 'pdf', 'colvis']
            buttons: ['excel', 'pdf']
        });

        table.buttons().container().appendTo('#datatable-buttons_wrapper .col-md-6:eq(0)');

        $('#histo').click(function(){
            $(this).parent().addClass('d-none');
            $('.home').addClass('d-none');

            $('.rowHisto').removeClass('d-none');
            $('#home').parent().removeClass('d-none');
        })
        
        $('#home').click(function(){
            $(this).parent().addClass('d-none');
            $('.rowHisto').addClass('d-none');

            $('.home').removeClass('d-none');
            $('#histo').parent().removeClass('d-none');
        })

                
    </script>

    <script>
        var fuel_level = new JustGage({
            id: "fuel_level",
            value: 0,
            min: 0,
            max: 100,
            title: "Fuel Level",
            label: "Fuel Level",
            pointer: true,
            textRenderer: function (val) {
                return val + ' %';
            },
            onAnimationEnd: function () {
            console.log('f: onAnimationEnd()');
            }
        });

        var oil_level = new JustGage({
            id: "oil_level",
            value: 0,
            min: 0,
            max: 100,
            title: "Oil Level",
            label: "Oil Level",
            pointer: true,
            textRenderer: function (val) {
                return val + ' %';
                
            },
            onAnimationEnd: function () {
            console.log('f: onAnimationEnd()');
            }
        });

        var water_level = new JustGage({
            id: "water_level",
            value: 0,
            min: 0,
            max: 100,
            title: "Water Level",
            label: "Water Level",
            pointer: true,
            textRenderer: function (val) {
                return val + ' %';
            },
            onAnimationEnd: function () {
            console.log('f: onAnimationEnd()');
            }
        });

        var air_pressure = new JustGage({
            id: "air_pressure",
            value: 0,
            min: 0,
            max: 100,
            title: "Air pressure",
            label: "Air pressure",
            pointer: true,
            textRenderer: function (val) {
                return val + ' mBar';
            },
            onAnimationEnd: function () {
                // console.log('f: onAnimationEnd()'); 
            }
        });

        var oil_pressure = new JustGage({
            id: "oil_pressure",
            value: 0,
            min: 0,
            max: 100,
            title: "Oil Pressure",
            label: "Oil Pressure",
            pointer: true,
            textRenderer: function (val) {
                return val + ' Bar';
                
            },
            onAnimationEnd: function () {
            console.log('f: onAnimationEnd()');
            }
        });

        var water_temp = new JustGage({
            id: "water_temp",
            value: -20,
            min: -20,
            max: 200,
            title: "Water Temperature",
            label: "Water Temperature",
            pointer: true,
            textRenderer: function (val) {
                return val + ' °C';
            },
            onAnimationEnd: function () {
                // console.log('f: onAnimationEnd()'); 
            }
        });

        var cooler_temp = new JustGage({
            id: "cooler_temp",
            value: -20,
            min: -20,
            max: 200,
            title: "Cooler Temperature",
            label: "Cooler Temperature",
            pointer: true,
            textRenderer: function (val) {
                return val + ' °C';
            },
            onAnimationEnd: function () {
                // console.log('f: onAnimationEnd()'); 
            }
        });

        var engine_speed = new JustGage({
            id: "engine_speed",
            value: 0,
            min: 0,
            max: 3000,
            title: "Engine Speed",
            label: "Engine Speed",
            pointer: true,
            textRenderer: function (val) {
                return val + ' rpm';
            },
            onAnimationEnd: function () {
                // console.log('f: onAnimationEnd()'); 
            }
        });

        var batt_voltage = new JustGage({
            id: "batt_voltage",
            value: 0,
            min: 0,
            max: 100,
            title: "Battery Voltage",
            label: "Battery Voltage",
            pointer: true,
            textRenderer: function (val) {
                return val + ' V';
            },
            onAnimationEnd: function () {
                // console.log('f: onAnimationEnd()'); 
            }
        });

        {# document.getElementById('Custom_wether_refresh').addEventListener('click', function () {
            fuel_level.refresh();
            oil_level.refresh();
            water_level.refresh();
            air_pressure.refresh();
            oil_pressure.refresh();
            water_temp.refresh();
            cooler_temp.refresh();
            engine_speed.refresh();
            batt_voltage.refresh();
            return false;
        }); #}

        setTimeout(
                function(){ 
                    swal.queue([{
                    title: 'Waiting...',
                    confirmButtonText: 'Confirm',
                    text: 'Please wait !',
                    //showCancelButton: true,
                    showLoaderOnConfirm: true,
                    //confirmButtonClass: 'btn btn-primary',
                    //cancelButtonClass: 'btn btn-danger ml-2',
                    preConfirm: function () {
                        return new Promise(function (resolve) { 
                            
                            $.getJSON("{{ path('update_genset_display_data', {'id': smartMod.id}) }}", function (result) {//{'selectedDate': $date},
                                swal({
                                    type: 'success', 
                                    title: 'The Dashbord have been updated !',
                                    // html: 'Submitted email: ' + email
                                });

                                setTimeout(function () {
                                    resolve()
                                }, 1000);

                                if( Object.keys(result).length > 0 ){
                                    console.log(result)
                                    //var dateLabel = Object.values(result['date']);

                                    //Mise à jour des jauges des données mécaniques
                                    fuel_level.refresh( parseFloat(result['Level'][0]) ?? 0);
                                    oil_level.refresh( parseFloat(result['Level'][1]) ?? 0);
                                    water_level.refresh( parseFloat(result['Level'][2]) ?? 0);
                                    air_pressure.refresh( parseFloat(result['Pressure'][0]) ?? 0);
                                    oil_pressure.refresh( parseFloat(result['Pressure'][1]) ?? 0);
                                    water_temp.refresh( parseFloat(result['Temp'][0]) ?? 0);
                                    cooler_temp.refresh( parseFloat(result['Temp'][1]) ?? 0);
                                    engine_speed.refresh( parseFloat(result['EngineSpeed']) ?? 0);
                                    batt_voltage.refresh( parseFloat(result['BattVolt']) ?? 0);

                                    //Mise à jour des paramètres du générateur
                                    $('#l1l2').text(String(result['Vcg'][0] + " V"))
                                    $('#l1l3').text(String(result['Vcg'][1] + " V"))
                                    $('#l2l3').text(String(result['Vcg'][2] + " V"))
                                    $('#l1N').text(String(result['Vsg'][0] + " V"))
                                    $('#l2N').text(String(result['Vsg'][1] + " V"))
                                    $('#l3N').text(String(result['Vsg'][2] + " V"))
                                    $('#l1l2M').text(String(result['Vcm'][0] + " V"))
                                    $('#l1l3M').text(String(result['Vcm'][1] + " V"))
                                    $('#l2l3M').text(String(result['Vcm'][2] + " V"))
                                    $('#I1').text(String(result['I'][0] + " A"))
                                    $('#I2').text(String(result['I'][1] + " A"))
                                    $('#I3').text(String(result['I'][2] + " A"))
                                    $('#idiff').text(String(result['Idiff'] + " mA"))   
                                    $('#freq').text(String(result['Freq'] + " Hz"))
                                    $('#htm').text(String(result['HTM']))  
                                    $('#update').text(String( moment( new Date(result['Date1']) ).format("DD MMM YYYY HH:mm:ss")) )

                                    //Affichage des derniers enregistrements données dynamiques
                                    $('#activePower').text(String(result['Power'][0] + " kW"))
                                    $('#reactivePower').text(String(result['Power'][1] + " kVAR"))
                                    $('#apparentPower').text(String(result['Power'][2] + " VAR"))
                                    $('#cosfi').text(String(result['Cosfi']))
                                    {# $('#trh').text(String(result['TRH'][0])) #}
                                    $('#trhd').text(String(result['TRH'][1]))
                                    $('#trhm').text(String(result['TRH'][2]))
                                    $('#trhy').text(String(result['TRH'][3]))
                                    {# $('#tep').text(String(result['TEP'][0])) #}
                                    $('#tepd').text(String(result['TEP'][1]))
                                    $('#tepm').text(String(result['TEP'][2]))
                                    $('#tepy').text(String(result['TEP'][3]))

                                    $('#fcd').text( String( parseFloat(result['FC'][0]).toFixed(2) ) )
                                    $('#fcm').text( String( parseFloat(result['FC'][1]).toFixed(2) ) )
                                    $('#fcy').text( String( parseFloat(result['FC'][2]).toFixed(2) ) )

                                    $('#fcdp').text( String( parseFloat(result['FC'][0]*{{smartMod.fuelPrice}}).toFixed(2) ) )
                                    $('#fcmp').text( String( parseFloat(result['FC'][1]*{{smartMod.fuelPrice}}).toFixed(2) ) )
                                    $('#fcyp').text( String( parseFloat(result['FC'][2]*{{smartMod.fuelPrice}}).toFixed(2) ) )
                                    
                                    $('#poed').text( String( (result['POE'][0]).toFixed(2) ) )
                                    $('#poem').text( String( parseFloat(result['POE'][1]).toFixed(2) ) )
                                    $('#poey').text( String( parseFloat(result['POE'][2]).toFixed(2) ) )
                                    
                                    //Day 
                                    prog = parseFloat(result['prevPOE'][0]) > 0 ? (parseFloat(result['POE'][0]) - parseFloat(result['prevPOE'][0])) * 100.0 / parseFloat(result['prevPOE'][0]) : parseFloat(result['POE'][0]);
                                    progressVal($('#poedProgVal'), $('#poedProg'), prog, true, false);
                                    //Month
                                    prog = parseFloat(result['prevPOE'][1]) > 0 ? (parseFloat(result['POE'][1]) - parseFloat(result['prevPOE'][1])) * 100.0 / parseFloat(result['prevPOE'][1]) : parseFloat(result['POE'][1]);
                                    progressVal($('#poemProgVal'), $('#poemProg'), prog, true, false);
                                    //Year
                                    prog = parseFloat(result['prevPOE'][2]) > 0 ? (parseFloat(result['POE'][2]) - parseFloat(result['prevPOE'][2])) * 100.0 / parseFloat(result['prevPOE'][2]) : parseFloat(result['POE'][2]);
                                    progressVal($('#poeyProgVal'), $('#poeyProg'), prog, true, false);

                                    if(parseInt(result['CGCR'][0])){//CG = 1
                                        $('#cg').removeClass('badge-danger')
                                        $('#cg').addClass('badge-success')
                                        $('#cg').children("h6").children("span").text('Closed')
                                        //$('#cgStatus').text('Closed')
                                        
                                    }
                                    else{//CG = 0
                                        $('#cg').removeClass('badge-success')
                                        $('#cg').addClass('badge-danger')
                                        $('#cg').children("h6").children("span").text('Open')
                                        //$('#cgStatus').text('Open')
                                        
                                    }      

                                    if(parseInt(result['Gensetrunning'])){//Genset running = 1
                                        $('#gensetStatus').removeClass('badge-danger')
                                        $('#gensetStatus').addClass('badge-success')
                                        $('#gensetStatus').children("h6").text('Running')
                                    }
                                    else{
                                        $('#gensetStatus').removeClass('badge-success')
                                        $('#gensetStatus').addClass('badge-danger')
                                        $('#gensetStatus').children("h6").text('Stop')
                                    }

                                    
                                    if(parseInt(result['CGCR'][1])){//CR = 1
                                        $('#cr').removeClass('badge-danger')
                                        $('#cr').addClass('badge-success')
                                        $('#cr').children("h6").children("span").text('Closed')
                                        //$('#crStatus').text('Closed')
                                        
                                    }
                                    else{//CR = 0
                                        $('#cr').removeClass('badge-success')
                                        $('#cr').addClass('badge-danger')
                                        $('#cr').children("h6").children("span").text('Open')
                                        //$('#crStatus').text('Open')
                                        
                                    }     

                                    if(parseInt(result['MainsPresence'])){//Mains Presence = 1
                                        $('#mainsStatus').removeClass('badge-danger')
                                        $('#mainsStatus').addClass('badge-success')
                                        $('#mainsStatus').children("h6").text('Present')
                                    }
                                    else{
                                        $('#mainsStatus').removeClass('badge-success')
                                        $('#mainsStatus').addClass('badge-danger')
                                        $('#mainsStatus').children("h6").text('Absent')
                                    }        
                                        
                                    updateAlarmStatus($('#lowFuel'), parseInt(result['LowFuel']))
                                    updateAlarmStatus($('#presenceWaterInFuel'), parseInt(result['PresenceWaterInFuel']))
                                    updateAlarmStatus($('#overspeed'), parseInt(result['Overspeed']))
                                    updateAlarmStatus($('#maxFreq'), parseInt(result['FreqAlarm'][0]))
                                    updateAlarmStatus($('#minFreq'), parseInt(result['FreqAlarm'][1]))
                                    updateAlarmStatus($('#maxVolt'), parseInt(result['VoltAlarm'][0]))
                                    updateAlarmStatus($('#minVolt'), parseInt(result['VoltAlarm'][1]))
                                    updateAlarmStatus($('#maxBattVolt'), parseInt(result['BattVoltAlarm'][0]))
                                    updateAlarmStatus($('#minBattVolt'), parseInt(result['BattVoltAlarm'][1]))
                                    updateAlarmStatus($('#shortCircuit'), parseInt(result['ShortCircuit']))
                                    updateAlarmStatus($('#maintenanceRequest'), parseInt(result['MaintenanceRequest']))
                                    updateAlarmStatus($('#differentialIntervention'), parseInt(result['DifferentialIntervention']))
                                    updateAlarmStatus($('#mainsIncSeq'), parseInt(result['IncSeq'][0]))
                                    updateAlarmStatus($('#genIncSeq'), parseInt(result['IncSeq'][1]))
                                    updateAlarmStatus($('#overload'), parseInt(result['Overload']))

                                    //Update Nb performed starts-up
                                    $('#npsd').text(result['NPS'][0])
                                    $('#nmid').text(result['NMI'][0])

                                    $('#npsm').text(result['NPS'][1])
                                    $('#nmim').text(result['NMI'][1])

                                    $('#npsy').text(result['NPS'][2])
                                    $('#nmiy').text(result['NMI'][2])
                                }        
                                else{
                                    //$('.spin').addClass('d-none');
                                    
                                }
                            }).fail(function() { 
                                swal('Oops...', 'Something went wrong!', 'error'
                                // footer: '<a href>Why do I have this issue?</a>'
                                );

                                setTimeout(function () {
                                    resolve()
                                }, 5000);
                             });
                        })
                    },
                    allowOutsideClick: false
                }]);

                $(".swal2-confirm").click();
                //alert("Hello"); 
                 
            }
        , 500);

        function updateAlarmStatus(id, value){
            if(value){
                id.removeClass('text-danger')
                id.addClass('text-success')
            }
            else{
                id.removeClass('text-success')
                id.addClass('text-danger')
            }
        }
    </script>

    <script>
        //Mixed Running Time - Energy Produced - Fuel Consumption(XAF) charts

        var options = {
            chart: {
                height: 380,
                type: 'line',
                stacked: false,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        position: 'top', // top, center, bottom
                    },
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: [0, 0, 3],
                curve: 'smooth'
            },
            noData: {
                text: 'Data not yet available',
                align: 'center',
                verticalAlign: 'middle',
                offsetX: 0,
                offsetY: 0,
                style: {
                    color: undefined,
                    fontSize: '14px',
                    fontFamily: undefined
                }
            },
            series: [{
                name: 'Running time',
                type: 'column',
                //data: [1.4, 2, 2.5, 1.5, 2.5, 2.8, 3.8, 4.6]
                data: []
            }, {
                name: 'Energy produced',
                type: 'column',
                //data: [1.1, 3, 3.1, 4, 4.1, 4.9, 6.5, 8.5]
                data: []
            }, {
                name: 'Fuel consumption',
                type: 'area',
                //data: [20, 29, 37, 36, 44, 45, 50, 58]
                data: []
            }],
            fill: {
                opacity: [0.25, 0.25, 0.25],
                gradient: {
                    inverseColors: false,
                    shade: 'light',
                    type: "vertical",
                    opacityFrom: 0.85,
                    opacityTo: 0.55,
                    stops: [0, 100, 100, 100]
                }
            },
            colors: ["#fbb624", "#77d0ba", "#fa5c7c"],
            xaxis: {
                //categories: [2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016],
                categories: [],
                labels: {
                    datetimeFormatter: {
                        year: 'yyyy',
                        month: 'MMM \'yy',
                        day: 'dd MMM',
                        hour: 'HH:mm'
                    }
                },
                title: {
                    text: moment().format('DD MMMM').toString(),
                    style: {
                        fontSize: '14px',
                        fontWeight: 'bold',
                        fontFamily: undefined,
                        color: '#444'
                    },
                }
            },
            yaxis: [
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#fbb624'
                    },
                    labels: {
                        style: {
                            color: '#fbb624',
                        }
                    },
                    title: {
                        text: "Hours"
                    },
                },
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#77d0ba'
                    },
                    labels: {
                        style: {
                            color: '#77d0ba',
                        },
                        offsetX: 10
                    },
                    title: {
                        text: "kWh",
                    },
                },
                {
                    opposite: true,
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#fa5c7c'
                    },
                    labels: {
                        style: {
                            color: '#fa5c7c',
                        }
                    },
                    title: {
                        text: "Liters"
                    }
                },
            ],
            tooltip: {
                theme: "dark",
                followCursor: true,
                y: {
                    formatter: function (y) {
                        //console.log(y)
                        if (typeof y !== "undefined") {
                            return y.toFixed(2) + ""
                        }
                        return y;
                    }
                },
                x: {
                    formatter: function (val, timestamp) {
                        return moment(new Date(val)).format("DD MMM YYYY")
                    }
                }
            },
            grid: {
                borderColor: '#f1f3fa'
            },
            legend: {
                //offsetY: -10,
                position: 'top',
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    yaxis: {
                        show: false
                    },
                    legend: {
                        show: false
                    }
                }
            }]
        }

        var PowerProduction_Barchart = new ApexCharts(
            document.querySelector("#apex_mixed1"),
            options
        );

        PowerProduction_Barchart.render();

        {# var options = {
            chart: {
                height: 380,
                type: 'bar',
                toolbar: {
                    show: false
                }
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        position: 'top', // top, center, bottom
                    },
                }
            },
            dataLabels: {
                enabled: true,
                formatter: function (val) {
                    return val + "%";
                },
                offsetY: -20,
                style: {
                    fontSize: '12px',
                    colors: ["#aeb4ce"]
                }
            },
            colors: ["#4facfe"],
            series: [{
                name: 'Inflation',
                data: [2.3, 3.1, 4.0, 10.1, 4.0, 3.6, 3.2, 2.3, 1.4, 0.8, 0.5, 0.2]
            }],
            xaxis: {
                categories: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                position: 'top',
                labels: {
                    offsetY: -18,

                },
                axisBorder: {
                    show: false
                },
                axisTicks: {
                    show: false
                },
                crosshairs: {
                    fill: {
                        type: 'gradient',
                        gradient: {
                            colorFrom: '#D8E3F0',
                            colorTo: '#BED1E6',
                            stops: [0, 100],
                            opacityFrom: 0.4,
                            opacityTo: 0.5,
                        }
                    }
                },
                tooltip: {
                    enabled: true,
                    offsetY: -35,
                    theme: "dark",
                }
            },
            fill: {
                gradient: {
                    enabled: false,
                    shade: 'light',
                    type: "horizontal",
                    shadeIntensity: 0.25,
                    gradientToColors: undefined,
                    inverseColors: true,
                    opacityFrom: 1,
                    opacityTo: 1,
                    stops: [50, 0, 100, 100]
                },
            },
            yaxis: {
                axisBorder: {
                    show: false
                },
                axisTicks: {
                    show: false,
                },
                labels: {
                    show: false,
                    formatter: function (val) {
                        return val + "%";
                    }
                }

            },
            title: {
                text: 'Monthly Inflation in Argentina, 2002',
                floating: true,
                offsetY: 350,
                align: 'center',
                style: {
                    color: '#aeb4ce'
                }
            },
            grid: {
                row: {
                    colors: ['#202846', '#1a203a'], // takes an array which will be repeated on columns
                    opacity: 0.2
                },
                borderColor: '#f1f3fa'
            },
            tooltip: {
                theme: "dark",
            },
        }

        var chart = new ApexCharts(
            document.querySelector("#apex_column2"),
            options
        );

        chart.render(); #}


        //Mixed Apparent Power - Active Power - Cosphi charts
        var options = {
            chart: {
                height: 380,
                type: 'line',
                stacked: false,
                toolbar: {
                    show: true
                }
            },
            stroke: {
                width: [2, 2, 2],
                curve: 'smooth'
            },
            noData: {
                text: 'Data not yet available',
                align: 'center',
                verticalAlign: 'middle',
                offsetX: 0,
                offsetY: 0,
                style: {
                    color: undefined,
                    fontSize: '14px',
                    fontFamily: undefined
                }
            },
            plotOptions: {
                bar: {
                    columnWidth: '50%'
                }
            },
            colors: ["#1ecab8", "#fbb624", "#f93b7a"],
            series: [{
                name: 'Apparent Power',
                type: 'line',
                //data: [23, 11, 22, 27, 13, 22, 37, 21, 44, 22, 30]
                data: []
            }, {
                name: 'Active Power',
                type: 'line',
                //data: [44, 55, 41, 67, 22, 43, 21, 41, 56, 27, 43]
                data: []
            }, {
                name: 'CosPhi',
                type: 'line',
                //data: [30, 25, 36, 30, 45, 35, 64, 52, 59, 36, 39]
                data: []
            }],
            fill: {
                opacity: [1, 1, 1],
                gradient: {
                    inverseColors: false,
                    shade: 'light',
                    type: "vertical",
                    opacityFrom: 0.85,
                    opacityTo: 0.55,
                    stops: [0, 100, 100, 100]
                }
            },
            //labels: ['01/01/2003', '02/01/2003', '03/01/2003', '04/01/2003', '05/01/2003', '06/01/2003', '07/01/2003', '08/01/2003', '09/01/2003', '10/01/2003', '11/01/2003'],
            labels: [],
            markers: {
                size: 0
            },
            legend: {
                //offsetY: -10,
                position: 'top',
            },
            xaxis: {
                type: 'datetime',
                categories: [],
                labels: {
                    datetimeFormatter: {
                        year: 'yyyy',
                        month: 'MMM \'yy',
                        day: 'dd MMM',
                        hour: 'HH:mm'
                    }
                },
                title: {
                    text: moment().format('DD MMMM').toString(),
                    style: {
                        fontSize: '14px',
                        fontWeight: 'bold',
                        fontFamily: undefined,
                        color: '#444'
                    },
                }
            },
            yaxis: [
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#1ecab8'
                    },
                    labels: {
                        style: {
                            color: '#1ecab8',
                        }
                    },
                    title: {
                        text: "kVA"
                    },
                },

                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#fbb624'
                    },
                    labels: {
                        style: {
                            color: '#fbb624',
                        },
                        offsetX: 10
                    },
                    title: {
                        text: "kW",
                    },
                },
                {
                    opposite: true,
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#f93b7a'
                    },
                    labels: {
                        style: {
                            color: '#f93b7a',
                        }
                    },
                    title: {
                        text: ""
                    }
                },

            ],    
            {# yaxis: {
                title: {
                    text: 'Points',
                },
            }, #}
            tooltip: {
                shared: true,
                intersect: false,
                theme: "dark",
                y: {
                    formatter: function (y) {
                        if (typeof y !== "undefined") {
                            return y.toFixed(2) + "";
                        }
                        return y;

                    }
                },
                x: {
                    formatter: function (val, timestamp) {
                        return moment(new Date(val)).format("DD MMM YYYY HH:mm")
                    }
                }
            },
            grid: {
                borderColor: '#f1f3fa'
            }
        }
        {# var options = {
            chart: {
                height: 380,
                type: 'line',
                stacked: false,
                toolbar: {
                    show: false
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: [0, 0, 3]
            },
            series: [{
                name: 'Apparent Power',
                type: 'line',
                data: [1.4, 3, 3.1, 4, 4.1, 4.9, 6.5, 8.5]
            }, {
                name: 'Active Power',
                type: 'line',
                data: [1.1, 2, 2.5, 1.5, 2.5, 2.8, 3.8, 4.6]
            }, {
                name: 'CosPhi',
                type: 'line',
                data: [0.85, 0.84, 0.86, 0.8, 0.83, 0.87, 0.86, 0.81]
            }],
            colors: ["#20016c", "#77d0ba", "#fa5c7c"],
            xaxis: {
                categories: [2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016],
            },
            yaxis: [
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#20016c'
                    },
                    labels: {
                        style: {
                            color: '#20016c',
                        }
                    },
                    title: {
                        text: "kVA"
                    },
                },

                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#77d0ba'
                    },
                    labels: {
                        style: {
                            color: '#77d0ba',
                        },
                        offsetX: 10
                    },
                    title: {
                        text: "kW",
                    },
                },
                {
                    opposite: true,
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#fa5c7c'
                    },
                    labels: {
                        style: {
                            color: '#fa5c7c',
                        }
                    },
                    title: {
                        text: ""
                    }
                },

            ],
            tooltip: {
                theme: "dark",
                followCursor: true,
                y: {
                    formatter: function (y) {
                        
                        return y;
                    }
                }
            },
            grid: {
                borderColor: '#f1f3fa'
            },
            legend: {
                offsetY: -10,
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    yaxis: {
                        show: false
                    },
                    legend: {
                        show: false
                    }
                }
            }]
        } #}

        var PowerProfile_Linechart = new ApexCharts(
            document.querySelector("#apex_mixed2"),
            options
        );

        PowerProfile_Linechart.render();

        {# // line-3

        var ts2 = 1484418600000;
        var dates = [];
        var spikes = [5, -5, 3, -3, 8, -8]
        for (var i = 0; i < 120; i++) {
            ts2 = ts2 + 86400000;
            var innerArr = [ts2, dataSeries[1][i].value];
            dates.push(innerArr)
        }

        var options = {
            chart: {
                type: 'area',
                stacked: false,
                height: 380,
                zoom: {
                enabled: true
                },
            },
            plotOptions: {
                line: {
                curve: 'smooth',

                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: [3]
            },
            series: [{
                name: 'XYZ MOTORS',
                data: dates
            }],
            markers: {
                size: 0,
                style: 'full',
            },
            colors: ['#fa5c7c'],
            title: {
                text: 'Stock Price Movement',
                align: 'left'
            },
            grid: {
                row: {
                colors: ['transparent', 'transparent'], // takes an array which will be repeated on columns
                opacity: 0.2
                },
                borderColor: '#f1f3fa'
            },
            fill: {
                gradient: {
                enabled: true,
                shadeIntensity: 1,
                inverseColors: false,
                opacityFrom: 0.5,
                opacityTo: 0.1,
                stops: [0, 70, 80, 100]
                },
            },
            yaxis: {
                min: 20000000,
                max: 250000000,
                labels: {
                formatter: function (val) {
                    return (val / 1000000).toFixed(0);
                },
                },
                title: {
                text: 'Price'
                },
            },
            xaxis: {
                type: 'datetime',
            },
            tooltip: {
                theme: "dark",
                shared: false,
                y: {
                formatter: function (val) {
                    return (val / 1000000).toFixed(0)
                }
                }
            },
            responsive: [{
                breakpoint: 600,
                options: {
                chart: {
                    toolbar: {
                    show: false
                    }
                },
                legend: {
                    show: false
                },
                }
            }]
        }

        var chart = new ApexCharts(
            document.querySelector("#apex_line3"),
            options
        );

        chart.render(); #}
    </script>

    <script>
        var _url = "{{ path('update_genset_graphs', {'smartMod':smartMod.id}) }}";
        {# $(function () {
            $('#datetimepicker10').datetimepicker({
                viewMode: 'years',
                format: 'DD/MM/YYYY', 
                minDate: moment("01-01-2021", "DD/MM/YYYY"),//"01-01-2020",
                //startDate: new Date("01-01-2020 00:00:00"),
                defaultDate: moment(),
                
            });
        });
        $("#datetimepicker10").on("dp.change", function (e) {
            //$('#datetimepicker6').data("DateTimePicker").maxDate(e.date);
            //console.log(e.date._d.toLocaleString().replace('à', ''));
            console.log(e.date._d);
            //$date = new Date(e.date._d);
            //console.log(e.date.format("YYYY-MM-DD H:i:s")._d);
            //console.log(Date.parse($date).toString('yyyy-MM-dd H:i:s'));
            
            updateDashboard(e.date._d);
                       
        }); #}
        
        {# $('#date').daterangepicker({
            singleDatePicker: true,
            showDropdowns: true,
            minYear: 2021,
            maxYear: parseInt(moment().format('YYYY'), 10)
        }, function (start, end, label) {
            var years = moment().diff(start, 'years');
            //alert("You are " + years + " years old!");
            console.log('Start : ' + start + ' end : ' + end);
            console.log(label);

        }); 
        $('#date').on('apply.daterangepicker', function (ev, picker) {
            //console.log(picker.startDate.format('YYYY-MM-DD'));
            //console.log(picker.endDate.format('YYYY-MM-DD'));
        
            startDate = picker.startDate.format('YYYY-MM-DD');
            endDate = picker.endDate.format('YYYY-MM-DD');
            
            console.log('startDate = ' + startDate);
            console.log('endDate = ' + endDate);
            updateDashboard();
            // block of code that runs when the click event triggers

        });
        var dp = $('#date').data('daterangepicker');
        console.log('drps = ' + dp.startDate.format('YYYY-MM-DD'));
        console.log('drpe = ' + dp.endDate.format('YYYY-MM-DD'));
        var startDate = dp.startDate.format('YYYY-MM-DD');
        var endDate = dp.endDate.format('YYYY-MM-DD'); #}

        var drp = $('#daterange').data('daterangepicker');
        console.log('drp = ' + drp.startDate.format('YYYY-MM-DD'));
        var startDate = drp.startDate.format('YYYY-MM-DD');
        var endDate = drp.endDate.format('YYYY-MM-DD');
        

        $('#daterange').on('apply.daterangepicker', function (ev, picker) {
            //console.log(picker.startDate.format('YYYY-MM-DD'));
            //console.log(picker.endDate.format('YYYY-MM-DD'));
        
            startDate = picker.startDate.format('YYYY-MM-DD');
            endDate = picker.endDate.format('YYYY-MM-DD');
            
            console.log('startDate = ' + startDate);
            console.log('endDate = ' + endDate);
            updateDashboard();
            // block of code that runs when the click event triggers

        });
        
        function displayNewData(chart, label, data, dateopt, multiple, xscale){
            //chart.data.labels = [];
            chart.updateOptions({
                xaxis: {
                    categories: []
                },
            });
            /*chart.updateOptions({
                xaxis: {
                    categories: label
                },
            });*/
            //chart.opts.labels = label;
            chart.updateOptions({
                labels: label
                
            });
            if(multiple > 1){
                var i = 0;
                chart.opts.series.forEach((dataset) => {
                    if( i < multiple){
                        dataset.data = [];
                        dataset.data = data[i++];
                        console.log(dataset.name);
                    }
                });
            }
            else if(multiple == 1){
                chart.updateSeries([{
                    data: []
                }]);
            
                chart.updateSeries([{
                    data: data
                }]);
            }
            if(xscale === 'day'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            //text: moment(dateopt).format('DD MMMM').toString(),
                            text: moment(dateopt[0]).format('DD MMMM YYYY').toString() + ' - ' + moment(dateopt[1]).format('DD MMMM YYYY').toString(),
                        }
                    },
                });
            }
            else if( xscale === 'month'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            text: moment(dateopt[0]).format('MMMM YYYY').toString() + ' - ' + moment(dateopt[1]).format('MMMM YYYY').toString(),
                        }
                    },
                });
            }
            //console.log(chart.options.scales.xAxes[0].scaleLabel.labelString);
            //preloaderChart(id, false);
            //chart.render();
        }            

        function updateDashboard(date){
            
            {# var $dat = new moment(date);
            var $date = $dat.format("YYYY-MM-DD").toString();
            //console.log($date);
            $dat = '%' + $date + '%';
            console.log($dat); #}

            $data = JSON.stringify({
                //"selectedDate": $dat, // tabGridId,
                "startDate": startDate + ' 00:00:00', // tabGridId,
                "endDate": endDate + '23:59:59', // tabFuelId,
            });

            // Danger

            swal.queue([{
                title: 'the graphs will be updated for the date range :',
                confirmButtonText: 'Confirm',
                text: 'From ' + startDate + ' To ' + endDate,
                showCancelButton: true,
                showLoaderOnConfirm: true,
                confirmButtonClass: 'btn btn-primary',
                cancelButtonClass: 'btn btn-danger ml-2',
                preConfirm: function () {
                    return new Promise(function (resolve) { 
                        
                        $.ajax({
                            type: "POST", // method type
                            contentType: "application/json; charset=utf-8",
                            url: _url, // /Target function that will be return result
                            data: $data, // parameter pass data is parameter name param is value
                            dataType: "json",
                            timeout: 120000, // 64241
                            success: function (result) {
                                // $('.fa-sync').removeClass('fa-spin');
                                console.log(result);
                                
                                swal({
                                    type: 'success', 
                                    title: 'The graphs have been updated !',
                                    // html: 'Submitted email: ' + email
                                });

                                setTimeout(function () {
                                    resolve()
                                }, 2000);

                                if( Object.keys(result).length > 0 ){
                                    var dateLabel = Object.values(result['date']);
                                    //console.log(Object.values(result['CourbeCroisé']));
                                    console.log(result);
                                    {# console.log(Object.values(result['SymI']));
                                    console.log(Object.values(result['SymV'])); #}
                                    
                                    
                                    displayNewData(PowerProduction_Barchart, Object.values(result['dateE']), Object.values(result['Mix1']), [startDate, endDate], 3, 'day');
                                    //displayNewData(PowerProduction_Barchart, Object.values(result['dateE']), Object.values(result['Mix1']), date, 3, 'month');
                                    //displayNewData1(PowerProduction_Barchart, Object.values(result['dateE']), Object.values(result['Mix1']), date, 1, 'month', '#spinPowerConsumption');
                                      
                                    displayNewData(PowerProfile_Linechart, dateLabel, Object.values(result['Mix2']), [startDate, endDate], 3, 'day');
                                    //displayNewData(PowerProfile_Linechart, dateLabel, Object.values(result['Mix2']), date, 3, 'day');
                                    
                                }
                            },
                            error: function (result) {
                                // console.log("Error");
                                // console.log(result);
                                swal('Oops...', 'Something went wrong!', 'error'
                                // footer: '<a href>Why do I have this issue?</a>'
                                );

                                setTimeout(function () {
                                    resolve()
                                }, 5000);
                            }
                        });
                    })
                },
                allowOutsideClick: false
            }]);
        }

        function progressVal(selectorVal, selectorIcon, prog, posLogique, isTime) {
            var DESC = 'mdi-menu-down';
            var ASC = 'mdi-menu-up';
            var greenColor = 'text-success';
            var redColor = 'text-danger';
            if (!isTime) {
                selectorVal.html(prog === null ? 0 : prog > 0 ? '+' + prog.toFixed(1) : prog.toFixed(1));
            }
            else {
                var diff = new Date(Math.abs(prog));
                var $dat = new moment(diff).subtract(timeZoneOffset, 'hours');
                var str = $dat.format('HH:mm:ss').toString()
                selectorVal.html(prog === null ? 0 : prog > 0 ? '+' + str : '-' + str);
            }
            if (posLogique) {
                if (prog > 0) {
                    selectorIcon.removeClass(DESC).addClass(ASC);
                    selectorIcon.removeClass(greenColor).addClass(redColor);
                    /*if (selectorIcon.hasClass(oldClass)) {
                        // it has class
                    } else {
                        // it doesn't have specified class
                    }*/
                }
                else {
                    selectorIcon.removeClass(ASC).addClass(DESC);
                    selectorIcon.removeClass(redColor).addClass(greenColor);
                }
            }
            else {
                if (prog > 0) {
                    selectorIcon.removeClass(DESC).addClass(ASC);
                    selectorIcon.removeClass(redColor).addClass(greenColor);
                    /*if (selectorIcon.hasClass(oldClass)) {
                        // it has class
                    } else {
                        // it doesn't have specified class
                    }*/
                }
                else {
                    selectorIcon.removeClass(ASC).addClass(DESC);
                    selectorIcon.removeClass(greenColor).addClass(redColor);
                }
            }
        }

    </script>

    {# <script>
        
        function removeData(chart) {
            chart.data.labels.pop();
            chart.data.datasets.forEach((dataset) => {
                dataset.data.pop();
            });
            chart.update();
        }

        
        function addData(chart, label, data) {
            chart.data.labels.push(label);
            chart.data.datasets.forEach((dataset) => {
                dataset.data.push(data);
            });
            chart.update();
        }

        function displayNewData(chart, label, data, dateopt, multiple, xscale, id){
            chart.data.labels = [];
            chart.data.datasets.forEach( (dataset) => {
                dataset.data = [];
            });
            chart.data.labels = label;
            if(multiple > 1){
                var i = 0;
                chart.data.datasets.forEach((dataset) => {
                    if( i < multiple) dataset.data = data[i++];
                });
            }
            else if(multiple == 1){
                /*chart.data.datasets.forEach((dataset) => {
                    dataset.data = data;
                });*/
                chart.data.datasets[0].data = data;
            }
            if(xscale === 'day') chart.options.scales.xAxes[0].scaleLabel.labelString = moment(dateopt).format('DD MMMM').toString();
            else if( xscale === 'month') chart.options.scales.xAxes[0].scaleLabel.labelString = moment(dateopt).format('MMMM').toString();
            //console.log(chart.options.scales.xAxes[0].scaleLabel.labelString);
            //preloaderChart(id, false);
            chart.update();
        }

        function displayNewData1(chart, label, data, dateopt, multiple, xscale, id){
            //chart.data.labels = [];
            chart.updateOptions({
                xaxis: {
                    categories: []
                },
            });
            /*chart.updateOptions({
                xaxis: {
                    categories: label
                },
            });*/
            //chart.opts.labels = label;
            chart.updateOptions({
                labels: label
                
            });
            if(multiple > 1){
                var i = 0;
                chart.opts.series.forEach((dataset) => {
                    if( i < multiple){
                        dataset.data = [];
                        dataset.data = data[i++];
                        console.log(dataset.name);
                    }
                });
            }
            else if(multiple == 1){
                chart.updateSeries([{
                    data: []
                }]);
            
                chart.updateSeries([{
                    data: data
                }]);
            }
            if(xscale === 'day'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            text: moment(dateopt).format('DD MMMM').toString(),
                        }
                    },
                });
            }
            else if( xscale === 'month'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            text: moment(dateopt).format('MMMM').toString(),
                        }
                    },
                });
            }
            //console.log(chart.options.scales.xAxes[0].scaleLabel.labelString);
            //preloaderChart(id, false);
            //chart.render();
        }

        //console.log(CourbedeCharge);

        $("#datetimepicker10").on("dp.change", function (e) {
            //$('#datetimepicker6').data("DateTimePicker").maxDate(e.date);
            //console.log(e.date._d.toLocaleString().replace('à', ''));
            //console.log(e.date._d);
            //$date = new Date(e.date._d);
            //console.log(e.date.format("YYYY-MM-DD H:i:s")._d);
            //console.log(Date.parse($date).toString('yyyy-MM-dd H:i:s'));
            $dat = new moment(e.date._d);
            $date = $dat.format("YYYY-MM-DD").toString();
            //console.log($date);
            $date = '%' + $date + '%';
            //console.log($date);

            //for($i = 1; $i <= (CourbedeCharge.data.labels.length*2)+100; $i++) removeData(CourbedeCharge);
           $('.spin').removeClass('d-none');
           {% if smartMod.modType == 'GRID' %}
                $("#PowerConsumption").css({ opacity: 0.2 });
                $("#CourbedeCharge").css({ opacity: 0.2 });
           {% elseif smartMod.modType == 'FUEL' %}
                $("#PowerProduction").css({ opacity: 0.2 });
                $("#CourbeCroisé").css({ opacity: 0.2 });
                $("#ActivityPlan").css({ opacity: 0.2 });
           {% endif %}
           $("#PowerProfile").css({ opacity: 0.2 });
           $("#VoltageProfile").css({ opacity: 0.2 });
           
           $.getJSON("{{ path('update_mod_graphs', {'id': smartMod.id}) }}",{'selectedDate': $date}, function (result) {
                if( Object.keys(result).length > 0 ){
                    var dateLabel = Object.values(result['date']);
                    //console.log(Object.values(result['CourbeCroisé']));
                    console.log(result);
                    console.log(Object.values(result['SymI']));
                    console.log(Object.values(result['SymV']));
                    $('.spin').addClass('d-none');
                        
                    {% if smartMod.modType == 'GRID' %}
                        $("#PowerConsumption").css({ opacity: 1 });
                        $("#CourbedeCharge").css({ opacity: 1 });
                        //displayNewData(PowerConsumption_Barchart, Object.values(result['dateE']), Object.values(result['kWh']), e.date._d, 1, 'month', '#spinPowerConsumption');
                        displayNewData1(PowerConsumption_Barchart, Object.values(result['dateE']), Object.values(result['kWh']), e.date._d, 1, 'month', '#spinPowerConsumption');
                        //preloaderChart(id, status);
                        //displayNewData(CourbedeCharge_Linechart, dateLabel, Object.values(result['S3ph']), e.date._d, 1, 'day');
                        displayNewData1(CourbedeCharge_Linechart, dateLabel, Object.values(result['S3ph']), e.date._d, 1, 'day');
                        //displayNewData(PowerProfile_Linechart, dateLabel, Object.values(result['S']), e.date._d, 3);
                        //displayNewData(VoltageProfile_Linechart, dateLabel, Object.values(result['V']), e.date._d, 3);
                        //displayNewData(IDDProfile_Linechart, dateLabel, Object.values(result['V']), e.date._d, 2);
                        //displayNewData(IDCProfile_Linechart, dateLabel, Object.values(result['V']), e.date._d, 2);
                    {% elseif smartMod.modType == 'FUEL' %}
                        $("#PowerProduction").css({ opacity: 1 });
                        $("#CourbeCroisé").css({ opacity: 1 });
                        $("#ActivityPlan").css({ opacity: 1 });
                        displayNewData(PowerProduction_Barchart, Object.values(result['dateE']), Object.values(result['kWh']), e.date._d, 1, 'month');
                        displayNewData(CourbeCroisé_BarLinechart, Object.values(result['dateE']), Object.values(result['CourbeCroisé']), e.date._d, 2, 'month');
                        displayNewData(ActivityPlan_Linechart, dateLabel, Object.values(result['S3ph']), e.date._d, 1, 'day');
                        
                    {% endif %}
                    $("#PowerProfile").css({ opacity: 1 });
                    $("#VoltageProfile").css({ opacity: 1 });
                    
                    //displayNewData(PowerProfile_Linechart, dateLabel, Object.values(result['S']), e.date._d, 3, 'day');
                    displayNewData1(PowerProfile_Linechart, dateLabel, Object.values(result['S']), e.date._d, 3, 'day');
                    //displayNewData(VoltageProfile_Linechart, dateLabel, Object.values(result['V']), e.date._d, 3, 'day');
                    displayNewData1(VoltageProfile_Linechart, dateLabel, Object.values(result['V']), e.date._d, 3, 'day');
                    //displayNewData(IDCProfile_Linechart, dateLabel, Object.values(result['IDC']), e.date._d, 2, 'day');
                    displayNewData1(IDCProfile_Linechart, dateLabel, Object.values(result['IDC']), e.date._d, 2, 'day');
                    //displayNewData(IDDProfile_Linechart, dateLabel, Object.values(result['IDD']), e.date._d, 2, 'day');
                    displayNewData1(IDDProfile_Linechart, dateLabel, Object.values(result['IDD']), e.date._d, 2, 'day');
                    displayNewData1(SymIProfile_Linechart, dateLabel, Object.values(result['SymI']), e.date._d, 2, 'day');
                    displayNewData1(SymVProfile_Linechart, dateLabel, Object.values(result['SymV']), e.date._d, 2, 'day');
                    displayNewData1(THDiProfile_Linechart, dateLabel, Object.values(result['THDi']), e.date._d, 3, 'day');
                    displayNewData1(THDi3phProfile_Linechart, dateLabel, Object.values(result['THDi3ph']), e.date._d, 1, 'day');
                    //console.log(PowerProfile_Linechart1.opts);
                }        
                else{
                    $('.spin').addClass('d-none');
                }
            });
            
        
        });
        
        //setInterval(function(){ updateChart()},5000);

    </script> #}
{% endblock %}