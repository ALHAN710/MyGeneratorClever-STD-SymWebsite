{% extends 'base.html.twig' %}

{% block title %}{#Genset {{smartMod.name|capitalize}} #}Home{% endblock %}

{% block stylesheets %}
    {#{{ encore_entry_link_tags('app') }}#}
    <link href="/plugins/daterangepicker/daterangepicker.css" rel="stylesheet" />

    <!-- Sweet Alert -->
    <link href="/plugins/sweet-alert2/sweetalert2.min.css" rel="stylesheet" type="text/css">

    <!-- DataTables -->
    <link href="/plugins/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <link href="/plugins/datatables/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <!-- Responsive datatable examples -->
    <link href="/plugins/datatables/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" /> 

{% endblock %}
        
{% block breadcrumbItem %}
<li class="breadcrumb-item"><a href="javascript:void(0);">{{zone.name}}</a></li>
{# {% if smartMod %}<li class="breadcrumb-item"><a href="javascript:void(0);">{{smartMod.name}}</a></li>{% endif %} #}
<li class="breadcrumb-item active">Home</li>
{% endblock %}

{% block pageTitle %}Home{% endblock %}

{% block body %}
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#overview" role="tab">Overview</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#historical" role="tab">Historicals</a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#energybilling" role="tab">Energy Billing</a>
        </li>                                                
        {# <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#alarm" role="tab">Alarm</a>
        </li>                               #}
        
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
        
        <div class="tab-pane active p-3" id="overview" role="tabpanel">
            {# {{dump(type)}} #}
            {% if zone.type == 'PUE Calculation' %}
                <div class="row">
                    <div class="col-12 col-sm-9">
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mt-0 mb-4"></h4>
                                        <div class="chart-demo">
                                            <div id="apex_mixed_pue_power_overview" class="apex-charts"></div>
                                        </div>                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->                            
                        </div><!--end row-->
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mt-0 mb-4"></h4>
                                        <div class="chart-demo">
                                            <div id="apex_mixed_climate_overview" class="apex-charts"></div>
                                        </div>                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                        </div><!--end row-->
                    </div>

                    <div class="col-12 col-sm-3">
                        
                        <div class="card crm-data-card bg-soft-warning">
                            <div class="card-body"> 
                                <div class="row">
                                    <div class="col-sm-4 align-self-center">
                                        <div class="data-icon">
                                            <i class="mdi mdi-spa bg-soft-warning rounded-circle"></i>
                                        </div>
                                    </div><!-- end col-->
                                    <div class="col-sm-8 text-center">
                                        <h3 class="text-white"><span id="instPUE">0</span></h3>
                                        <p class="text-white font-weight-bold mb-0">PUE</p>
                                    </div><!-- end col-->
                                </div><!-- end row-->                                                                                     
                            </div><!--end card-body--> 
                        </div><!--end card--> 
                        
                        <div class="card crm-data-card bg-soft-blue">
                            <div class="card-body"> 
                                <div class="row">
                                    <div class="col-sm-4 align-self-center">
                                        <div class="data-icon">
                                            <i class="mdi mdi-flash bg-soft-blue rounded-circle"></i>
                                        </div>
                                    </div><!-- end col-->
                                    <div class="col-sm-8 text-center">
                                        <h3 class="text-white"><span id="it_power">0</span> kW</h3>
                                        <p class="text-white font-weight-bold mb-0">IT Power</p>
                                    </div><!-- end col-->
                                </div><!-- end row-->                                                                                     
                            </div><!--end card-body--> 
                        </div><!--end card--> 
                        <div class="card crm-data-card bg-soft-blue">
                            <div class="card-body"> 
                                <div class="row">
                                    <div class="col-sm-4 align-self-center">
                                        <div class="data-icon">
                                            <i class="mdi mdi-flash bg-soft-blue rounded-circle"></i>
                                        </div>
                                    </div><!-- end col-->
                                    <div class="col-sm-8 text-center">
                                        <h3 class="text-white"><span id="datacenter_power">0</span> kW</h3>
                                        <p class="font-weight-bold text-white mb-0">DataCenter</p>
                                    </div><!-- end col-->
                                </div><!-- end row-->                                                                                     
                            </div><!--end card-body--> 
                        </div><!--end card--> 
                        
                        {# <div class="float-left mt-0">
                        </div> #}
                        <small>Last update <span id="update">Y-m-d HH:mm:ss</span></small>

                        <div class="card crm-data-card bg-soft-pink">
                            <div class="card-body text-center"> 
                                <div class="row">
                                    <div class="col-sm-4 align-self-center">
                                        <div class="data-icon">
                                            <i class="mdi mdi-thermometer-lines bg-soft-pink rounded-circle"></i>
                                        </div>
                                    </div><!-- end col-->
                                    <div class="col-sm-8 text-center">
                                        <h3 class="text-white"><span id="temp_indoor">0</span> °C</h3>
                                        <p class="text-white font-weight-bold mb-0">Temperature Indoor</p>
                                    </div><!-- end col-->
                                
                                </div>
                            </div><!--end card-body--> 
                        </div><!--end card-->

                        <div class="card crm-data-card bg-soft-pink">
                            <div class="card-body text-center"> 
                                <div class="row">
                                    <div class="col-sm-4 align-self-center">
                                        <div class="data-icon">
                                            <i class="mdi mdi-thermometer-lines bg-soft-pink rounded-circle"></i>
                                        </div>
                                    </div><!-- end col-->
                                    <div class="col-sm-8 text-center">
                                        <h3 class="text-white"><span id="temp_outdoor">0</span> °C</h3>
                                        <p class="text-white font-weight-bold mb-0">Temperature Outdoor</p>
                                    </div><!-- end col-->
                                </div><!--end card-body--> 
                                
                                </div>
                        </div><!--end card-->

                        <div class="card crm-data-card bg-soft-success">
                            <div class="card-body text-center"> 
                                <div class="row">
                                    <div class="col-sm-4 align-self-center">
                                        <div class="data-icon">
                                            <i class="mdi mdi-opacity bg-soft-success rounded-circle"></i>
                                        </div>
                                    </div><!-- end col-->
                                    <div class="col-sm-8 text-center">
                                        <h3 class="text-white"><span id="hum_indoor">0</span> %</h3>
                                        <p class="text-white font-weight-bold mb-0">Humidity Indoor</p>
                                    </div><!-- end col-->
                                    
                                </div>
                            </div><!--end card-body--> 
                        </div><!--end card-->

                        <div class="card crm-data-card bg-soft-success">
                            <div class="card-body text-center"> 
                                <div class="row">
                                    <div class="col-sm-4 align-self-center">
                                        <div class="data-icon">
                                            <i class="mdi mdi-opacity bg-soft-success rounded-circle"></i>
                                        </div>
                                    </div><!-- end col-->
                                    <div class="col-sm-8 text-center">
                                        <h3 class="text-white"><span id="hum_outdoor">0</span> %</h3>
                                        <p class="text-white font-weight-bold mb-0">Humidity Outdoor</p>
                                    </div><!-- end col-->
                                
                                </div>
                            </div><!--end card-body--> 
                        </div><!--end card-->                        
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_mixed_pue_energy_overview" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->
                </div><!--end row-->

                {# <div class="row ">
                    <div class="col">
                        <div class="card crm-data-card">
                            <div class="card-body"> 
                                <div class="row">
                                    <div class="col-sm-4 align-self-center">
                                        <div class="data-icon">
                                            <i class="mdi mdi-spa rounded-circle bg-soft-primary"></i>
                                        </div>
                                    </div><!-- end col-->
                                    <div class="col-sm-8">
                                        <h3 class="text-primary"><span id="instPUE">0</span></h3>
                                        <p class="text-muted font-14 mb-0">Instant PUE</p>
                                    </div><!-- end col-->
                                </div><!-- end row-->                                                                                     
                            </div><!--end card-body--> 
                        </div><!--end card-->                                      
                    </div>
                    <div class="col">
                        <div class="card crm-data-card">
                            <div class="card-body"> 
                                <div class="row">
                                    <div class="col-sm-4 align-self-center">
                                        <div class="data-icon">{ mdi mdi-spa }
                                            <i class="mdi mdi-spa rounded-circle bg-soft-success"></i>
                                        </div>
                                    </div><!-- end col-->
                                    <div class="col-sm-8">
                                        <h3 class="text-success"><span id="intPUE">0</span></h3>
                                        <p class="text-muted font-14 mb-0">Interval PUE</p>
                                    </div><!-- end col-->
                                </div><!-- end row-->                                                                                     
                            </div><!--end card-body--> 
                        </div><!--end card-->                                      
                    </div>
                </div> #}
            {% else %}
                <div class="row">
                    <div class="col-12 col-sm-6">
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mt-0 mb-4">Active Energy Flow</h4>
                                        <div class="">
                                            <div id="apex_pie_active_energy_flow_overview" class="apex-charts"></div>
                                        </div>                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                        </div>
                        <div class="row">    
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mt-0 mb-4">Reactive Energy Flow</h4>
                                        <div class="">
                                            <div id="apex_pie_reactive_energy_flow_overview" class="apex-charts"></div>
                                        </div>                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6">
                        <div class="row">
                            <div class="col">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mt-0 mb-4"></h4>
                                        <div class="table-responsive shopping-cart">
                                            {# {{dump(smartModsProduction)}} #}
                                            <table class="table mb-0">
                                                <thead>
                                                    <tr>
                                                        <th class="text-center">P (kW)</th>                                                        
                                                        <th class="text-center">S (kVA)</th>                                                        
                                                        <th class="text-center">CosPhi </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td class="text-center"><span id="p_overview">0.00</span></td>
                                                        <td class="text-center"><span id="s_overview">0.00</span></td>
                                                        <td class="text-center"><span id="fp_overview">0.00</span></td>                                                        
                                                                                            
                                                    </tr>
                                                    {# {% for smartMod in zone.smartMods %}
                                                        {% if smartMod.modType ==  'Load Meter' %}
                                                        <tr>
                                                            <td>
                                                                <p class="d-inline-block align-middle mb-0 product-name">{{smartMod.name}}</p> 
                                                            </td>
                                                            <td class="text-center"><span id="p_{{smartMod.id}}_overview">0.00</span></td>
                                                            <td class="text-center"><span id="s_{{smartMod.id}}_overview">0.00</span></td>
                                                            <td class="text-center"><span id="fp_{{smartMod.id}}_overview">0.00</span></td>                                                        
                                                                                                
                                                        </tr>
                                                        {% endif %}
                                                    {% endfor %} #}
                                                    
                                                </tbody>
                                            </table>
                                        </div><!--end re-table-->                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                                
                                <div class="row float-right">
                                    <small>Last update <span id="update"> YYYY-MM-DD HH:mm:ss</span></small>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mt-0 mb-4"></h4>
                                        <div class="chart-demo">
                                            <div id="apex_mixed_PSCosfi_overview" class="apex-charts"></div>
                                        </div>                                        
                                    </div><!--end card-body-->
                                </div><!--end card-->
                            </div><!--end col-->
                        </div><!--end row-->
                    </div>
                </div>
                
            {% endif %}

            {# {% if type == 'zone sans' %}
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_total_active_power" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->                            
                </div><!--end row-->
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_total_energy" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->
                </div><!--end row-->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_total_power_factor" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->                            
                </div><!--end row-->
            {% elseif type == 'zone avec' %}
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_mixed_power" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->                            
                </div><!--end row-->
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_mixed_energy" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->
                </div><!--end row-->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_mixed_power_factor" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->                            
                </div><!--end row-->
                { <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4">Column Chart with Datalabels</h4>
                                <div class="chart-demo">
                                    <div id="apex_column2" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->    
                </div> }
                {% if smartMod %}
                    {% if smartMod.nbPhases == 3 %}
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title mt-0 mb-4"></h4>
                                    <div class="chart-demo">
                                        <div id="apex_mixed_active_power" class="apex-charts"></div>
                                    </div>                                        
                                </div><!--end card-body-->
                            </div><!--end card-->
                        </div><!--end col-->                            
                    </div><!--end row-->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title mt-0 mb-4"></h4>
                                    <div class="chart-demo">
                                        <div id="apex_mixed_cosfi" class="apex-charts"></div>
                                    </div>                                        
                                </div><!--end card-body-->
                            </div><!--end card-->
                        </div><!--end col-->                            
                    </div><!--end row-->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title mt-0 mb-4"></h4>
                                    <div class="chart-demo">
                                        <div id="apex_mixed_voltage" class="apex-charts"></div>
                                    </div>                                        
                                </div><!--end card-body-->
                            </div><!--end card-->
                        </div><!--end col-->                            
                    </div><!--end row-->
                    {% elseif smartMod.nbPhases == 1 %}
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title mt-0 mb-4"></h4>
                                    <div class="chart-demo">
                                        <div id="apex_mixed_PSCos" class="apex-charts"></div>
                                    </div>                                        
                                </div><!--end card-body-->
                            </div><!--end card-->
                        </div><!--end col-->                            
                    </div><!--end row-->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title mt-0 mb-4"></h4>
                                    <div class="chart-demo">
                                        <div id="apex_voltage" class="apex-charts"></div>
                                    </div>                                        
                                </div><!--end card-body-->
                            </div><!--end card-->
                        </div><!--end col-->                            
                    </div><!--end row-->
                    {% endif %}
                {% endif %}
                
                { <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4">Zoomable Timeseries</h4>
                                <div class="chart-demo">
                                    <div id="apex_line3" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->
                </div><!--end row--> }
            {% elseif type == 'load meter' %}
            {% endif %} #}
            
            
        </div>
        <div class="tab-pane p-3" id="historical" role="tabpanel">
            {# {{dump(type)}} #}
            <div class="row">
                <div class="col">
                    <label class="my-3">Pick Date Ranges</label>
                    <div class="input-group mb-3">  
                        <input type="text" id="daterange" class="form-control" value="">
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="dripicons-calendar"></i></span>
                        </div>
                    </div>
                </div>
            </div>

            {% if zone.type == 'PUE Calculation' %}
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_mixed_pue_power" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->                            
                </div><!--end row-->

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_mixed_climate" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->
                </div><!--end row-->
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_mixed_pue_energy" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->
                </div><!--end row-->

                {# <div class="row ">
                    <div class="col">
                        <div class="card crm-data-card">
                            <div class="card-body"> 
                                <div class="row">
                                    <div class="col-sm-4 align-self-center">
                                        <div class="data-icon">
                                            <i class="mdi mdi-spa rounded-circle bg-soft-primary"></i>
                                        </div>
                                    </div><!-- end col-->
                                    <div class="col-sm-8">
                                        <h3 class="text-primary"><span id="instPUE">0</span></h3>
                                        <p class="text-muted font-14 mb-0">Instant PUE</p>
                                    </div><!-- end col-->
                                </div><!-- end row-->                                                                                     
                            </div><!--end card-body--> 
                        </div><!--end card-->                                      
                    </div>
                    <div class="col">
                        <div class="card crm-data-card">
                            <div class="card-body"> 
                                <div class="row">
                                    <div class="col-sm-4 align-self-center">
                                        <div class="data-icon">{ mdi mdi-spa }
                                            <i class="mdi mdi-spa rounded-circle bg-soft-success"></i>
                                        </div>
                                    </div><!-- end col-->
                                    <div class="col-sm-8">
                                        <h3 class="text-success"><span id="intPUE">0</span></h3>
                                        <p class="text-muted font-14 mb-0">Interval PUE</p>
                                    </div><!-- end col-->
                                </div><!-- end row-->                                                                                     
                            </div><!--end card-body--> 
                        </div><!--end card-->                                      
                    </div>
                </div> #}
            {% endif %}


            <div class="row">

                <div class="col-12 col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="header-title mt-0 mb-4">Active Energy Flow</h4>
                            <div class="">
                                <div id="apex_pie_active_energy_flow" class="apex-charts"></div>
                            </div>                                        
                        </div><!--end card-body-->
                    </div><!--end card-->
                </div><!--end col-->
                
                <div class="col-12 col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="header-title mt-0 mb-4">Reactive Energy Flow</h4>
                            <div class="">
                                <div id="apex_pie_reactive_energy_flow" class="apex-charts"></div>
                            </div>                                        
                        </div><!--end card-body-->
                    </div><!--end card-->
                </div>

            </div>
            
            <div class="row">
                <div class="col">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="header-title mt-0 mb-4"></h4>
                            <div class="table-responsive shopping-cart">
                                {# {{dump(smartModsProduction)}} #}
                                <table class="table mb-0">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th class="text-center">Smax (kVA)</th>                                                        
                                            <th class="text-center">CosPhi </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for smartMod in zone.smartMods %}
                                            {% if smartMod.modType ==  'Load Meter' %}
                                            <tr>
                                                <td>
                                                    <p class="d-inline-block align-middle mb-0 product-name">{{smartMod.name}}</p> 
                                                </td>
                                                <td class="text-center"><span id="smax_{{smartMod.id}}">0</span></td>
                                                <td class="text-center"><span id="fp_{{smartMod.id}}">0</span></td>                                                        
                                                                                    
                                            </tr>
                                        {% endif %}
                                        {% endfor %}
                                        
                                    </tbody>
                                </table>
                            </div><!--end re-table-->                                        
                        </div><!--end card-body-->
                    </div><!--end card-->
                    
                </div>
            </div>

            {# {% if type == 'zone sans' %}
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_total_active_power" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->                            
                </div><!--end row-->
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_total_energy" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->
                </div><!--end row-->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_total_power_factor" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->                            
                </div><!--end row-->
            {% elseif type == 'zone avec' %}
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_mixed_power" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->                            
                </div><!--end row-->
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_mixed_energy" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->
                </div><!--end row-->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4"></h4>
                                <div class="chart-demo">
                                    <div id="apex_mixed_power_factor" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->                            
                </div><!--end row-->
                { <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4">Column Chart with Datalabels</h4>
                                <div class="chart-demo">
                                    <div id="apex_column2" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->    
                </div> }
                {% if smartMod %}
                    {% if smartMod.nbPhases == 3 %}
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title mt-0 mb-4"></h4>
                                    <div class="chart-demo">
                                        <div id="apex_mixed_active_power" class="apex-charts"></div>
                                    </div>                                        
                                </div><!--end card-body-->
                            </div><!--end card-->
                        </div><!--end col-->                            
                    </div><!--end row-->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title mt-0 mb-4"></h4>
                                    <div class="chart-demo">
                                        <div id="apex_mixed_cosfi" class="apex-charts"></div>
                                    </div>                                        
                                </div><!--end card-body-->
                            </div><!--end card-->
                        </div><!--end col-->                            
                    </div><!--end row-->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title mt-0 mb-4"></h4>
                                    <div class="chart-demo">
                                        <div id="apex_mixed_voltage" class="apex-charts"></div>
                                    </div>                                        
                                </div><!--end card-body-->
                            </div><!--end card-->
                        </div><!--end col-->                            
                    </div><!--end row-->
                    {% elseif smartMod.nbPhases == 1 %}
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title mt-0 mb-4"></h4>
                                    <div class="chart-demo">
                                        <div id="apex_mixed_PSCos" class="apex-charts"></div>
                                    </div>                                        
                                </div><!--end card-body-->
                            </div><!--end card-->
                        </div><!--end col-->                            
                    </div><!--end row-->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title mt-0 mb-4"></h4>
                                    <div class="chart-demo">
                                        <div id="apex_voltage" class="apex-charts"></div>
                                    </div>                                        
                                </div><!--end card-body-->
                            </div><!--end card-->
                        </div><!--end col-->                            
                    </div><!--end row-->
                    {% endif %}
                {% endif %}
                
                { <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title mt-0 mb-4">Zoomable Timeseries</h4>
                                <div class="chart-demo">
                                    <div id="apex_line3" class="apex-charts"></div>
                                </div>                                        
                            </div><!--end card-body-->
                        </div><!--end card-->
                    </div><!--end col-->
                </div><!--end row--> }
            {% elseif type == 'load meter' %}
            {% endif %} #}
            
            
        </div>

        <div class="tab-pane p-3" id="energybilling" role="tabpanel">
            
            <div class="card">
                <div class="card-body">
                    <h5 class="mt-0 mb-3 "><a href="#" id="histo" class="text-decoration"><u>Consulter l'historique</u> <i class="dripicons-arrow-up"></i></a></h5>
                    <h5 class="mt-0 mb-3 d-none"><a href="#" id="fact" class="text-decoration"><u>Voir Facture</u></a></h5>
                    {# <div class="table-responsive shopping-cart">
                        <table class="table mb-0">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th class="text-center">Pointe</th>                                                        
                                    <th class="text-center">Hors Pointe</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <p class="d-inline-block align-middle mb-0 product-name">Energie active (kWh)</p> 
                                    </td>
                                    <td class="text-center">2</td>
                                    <td class="text-center">198</td>                                                        
                                </tr>
                                <tr>
                                    <td>
                                        <p class="d-inline-block align-middle mb-0 product-name">Energie reactive (kVARh)</p> 
                                    </td>
                                    <td class="text-center">2</td>
                                    <td class="text-center">15</td>                                                       
                                </tr>                                                  
                            </tbody>
                        </table>
                    </div><!--end re-table--> #}
                    <div class="row rowFact">
                        <div class="row">
                            <div class="col">
                                <label class="my-3">Pick Date Ranges</label>
                                <div class="input-group mb-3">  
                                    <input type="text" id="daterangebilling" class="form-control" value="">
                                    <div class="input-group-append">
                                        <span class="input-group-text"><i class="dripicons-calendar"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">

                                <h4 class="header-title mt-0 mb-3 text-center">Données de puissance</h4>
                
                                <div class="total-payment">
                                    <table class="table mb-0">
                                        <tbody>
                                            <tr>
                                                <td class="payment-title">Puissance souscrite zone (kVA)</td>
                                                <td>{{zone.powerSubscribed}}</td>
                                            </tr>
                                            <tr>
                                                <td class="payment-title">Facteur de puissance</td>
                                                <td><span id="PF">0.85</span></td>
                                            </tr>
                                            <tr>
                                                <td class="payment-title">Nombre d'heures d'utilisation Psous</td>
                                                <td><span id="NHU_Psous">0</span> heures</td>
                                            </tr>
                                            <tr>
                                                <td class="payment-title">Nb d'heures d'utilisation source AC GRID</td>
                                                <td ><span id="NHU_Grid">0</span> heures</td>
                                            </tr>
                                            <tr>
                                                <td class="payment-title">Nb d'heures d'utilisation source GE</td>
                                                <td ><span id="NHU_GE">0</span> heures</td>
                                            </tr>
                                            {# <tr>
                                                <td class="payment-title">Nb d'heures d'utilisation source DC</td>
                                                <td ><span id="NHU_DC">0</span> heures</td>
                                            </tr> #}
                                            <tr>
                                                <td class="payment-title">Durée de dépassement</td>
                                                <td ><span id="DuréeDépassement">0</span> heures</td>
                                            </tr>
                                            <tr>
                                                <td class="payment-title">Puissance Max lue (kVA)</td>
                                                <td><span id="SmaxLue">0</span> </td>
                                            </tr>
                                        </tbody>
                                    </table><!--end table-->
                                </div><!--end total-payment-->
                            </div>
                            <div class="col">
                                <div class="table-responsive shopping-cart">
                                    <table class="table mb-0">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th class="text-center">Consommation (kWh)</th>                                                        
                                                <th class="text-center">Tarif (XAF/kWh)</th>
                                                <th class="text-center">Montant (XAF)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <p class="d-inline-block align-middle mb-0 product-name">Energie Active Pointe</p> 
                                                </td>
                                                <td class="text-center"><span id="EAP">0</span></td>
                                                <td class="text-center"><span id="EAP_tarif">{{zone.site.tarification.tarifAcGridP}}</span></td>                                                        
                                                <td class="text-center"><span id="EAP_Amount">0</span></td>                                                        
                                            </tr>
                                            <tr>
                                                <td>
                                                    {# <img src="../assets/images/products/3.png" alt="" height="52"> #}
                                                    <p class="d-inline-block align-middle mb-0 product-name">Energie Active Hors Pointe</p> 
                                                </td>
                                                <td class="text-center"><span id="EAHP">0</span></td>
                                                <td class="text-center"><span id="EAHP_tarif">{{zone.site.tarification.tarifAcGridHp}}</span></td>                                                       
                                                <td class="text-center"><span id="EAHP_Amount">0</span></td>                                                       
                                            </tr>
                                        </tbody>
                                    </table>
                                </div><!--end re-table-->
                                <div class="total-payment">
                                    <table class="table mb-0">
                                        <tbody>
                                            <tr>
                                                <td class="payment-title">Sous-total</td>
                                                <td class="text-center"><span id="sTotal">0</span></td>
                                            </tr>
                                            <tr>
                                                <td class="payment-title">Prime Fixe</td>
                                                <td class="text-center"><span id="primeFixe">{{zone.powerSubscribed * zone.site.tarification.primeFixe}}</span></td>
                                            </tr>
                                            <tr>
                                                <td class="payment-title">Total HT</td>
                                                <td class="text-center"><span id="Amount_HT">0</span></td>
                                            </tr>
                                            <tr>
                                                <td class="payment-title">Taxes(TVA={{zone.site.tarification.tva}}%)</td>
                                                <td class="text-center"><span id="taxes">0</span></td>
                                            </tr>
                                            <tr>
                                                <td class="payment-title">Total TTC</td>
                                                <td class="text-center text-white"><span id="Amount_TTC">0</span></td>
                                            </tr>
                                        </tbody>
                                    </table><!--end table-->
                                </div><!--end total-payment-->
                            </div>
                        </div>
                    </div>

                    <div class="row rowHisto d-none">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
    
                                    {# <h4 class="mt-0 header-title">Buttons example</h4> #}
                                    
                                    <table id="datatable-buttons" class="table table-striped table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                        <thead>
                                            <tr class="text-center">
                                                <th></th>
                                                <th>Montant TTC</th>
                                                <th>Conso Pointe (kWh)</th>
                                                <th>Conso HP(kWh)</th>
                                                <th>Psous (kVA)</th>
                                                <th>Pmax (kVA)</th>
                                                <th>CosPhi (kVA)</th>
                                            </tr>
                                        </thead>
    
    
                                        <tbody>
                                            <tr>
                                                <th>Jan-2020</th>
                                                <td class="text-center">7500</td>
                                                <td class="text-center">11</td>
                                                <td class="text-center">5</td>
                                                <td class="text-center">20</td>
                                                <td class="text-center">9</td>
                                                <td class="text-center">0.86</td>
                                            </tr>
                                            <tr>
                                                <th>Fév-2020</th>
                                                <td class="text-center">5500</td>
                                                <td class="text-center">8</td>
                                                <td class="text-center">3</td>
                                                <td class="text-center">20</td>
                                                <td class="text-center">5</td>
                                                <td class="text-center">0.861</td>
                                            </tr>
                                            <tr>
                                                <th>Mars-2020</th>
                                                <td class="text-center">6800</td>
                                                <td class="text-center">10</td>
                                                <td class="text-center">4</td>
                                                <td class="text-center">20</td>
                                                <td class="text-center">6</td>
                                                <td class="text-center">0.87</td>
                                            </tr>
                                            <tr>
                                                <th>Avr-2020</th>
                                                <td class="text-center">7200</td>
                                                <td class="text-center">10.5</td>
                                                <td class="text-center">3</td>
                                                <td class="text-center">20</td>
                                                <td class="text-center">5.25</td>
                                                <td class="text-center">0.86</td>
                                            </tr>
                                            <tr>
                                                <th>Mai-2020</th>
                                                <td class="text-center">7600</td>
                                                <td class="text-center">11.5</td>
                                                <td class="text-center">5</td>
                                                <td class="text-center">20</td>
                                                <td class="text-center">7</td>
                                                <td class="text-center">0.88</td>
                                            </tr>
                                            <tr>
                                                <th>Juin-2020</th>
                                                <td class="text-center">7100</td>
                                                <td class="text-center">9.5</td>
                                                <td class="text-center">3</td>
                                                <td class="text-center">20</td>
                                                <td class="text-center">5.5</td>
                                                <td class="text-center">0.865</td>
                                            </tr>
                                            <tr>
                                                <th>Juil-2020</th>
                                                <td class="text-center">6500</td>
                                                <td class="text-center">8.25</td>
                                                <td class="text-center">2.5</td>
                                                <td class="text-center">20</td>
                                                <td class="text-center">3.75</td>
                                                <td class="text-center">0.8</td>
                                            </tr>
                                            <tr>
                                                <th>Août-2020</th>
                                                <td class="text-center">7000</td>
                                                <td class="text-center">10.75</td>
                                                <td class="text-center">4</td>
                                                <td class="text-center">20</td>
                                                <td class="text-center">6.25</td>
                                                <td class="text-center">0.86</td>
                                            </tr>
                                        </tbody>
                                    </table>        
                                </div>
                            </div>
                        </div> <!-- end col -->
                    </div> <!-- end row -->
                    
                </div><!--end card-body-->
            </div>  
        </div>

        <div class="tab-pane p-3" id="alarm" role="tabpanel">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">

                            <h4 class="mt-0 header-title">Alarm Reporting</h4>

                            <div class="row">
                                <div class="col">
                                    <label class="my-3">Pick Date Ranges</label>
                                    <div class="input-group mb-3">  
                                        <input type="text" id="daterangeAlarm" class="form-control" value="">
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class="dripicons-calendar"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            
                            <table id="datatable-buttons-alarm" class="table table-striped table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                <thead>
                                    <tr>
                                        <th>Alarm Label</th>
                                        <th class="text-center">Occurrence</th>
                                        <th class="text-center">Actions</th>
                                    </tr>
                                </thead>

                                <tbody>
                                    {% for alarm in alarms %}
                                    <tr>
                                        <th>{{alarm.label}}</th>
                                        <td class="text-center" id="alarm_{{alarm.id}}">0</td>
                                        <td class="text-center"><a href="#" class="alarmDetails text-decoration" data-alarm={{alarm.id}}><u>Details</u></a></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>        
                        </div>
                    </div>
                </div> <!-- end col -->
            </div> <!-- end row -->
        </div>                                                
                    
    </div>     
{% endblock %}


{% block javascripts %}
    <script src="/plugins/justgage/justgage.js"></script>
    <script src="/plugins/justgage/raphael-2.1.4.min.js"></script>
    {# <script src="/pages/jquery.justgage.init.js"></script> #}
    {#{{ encore_entry_script_tags('app') }}#}

    <script src="/plugins/moment/moment.js"></script>
    <script src="/plugins/daterangepicker/daterangepicker.js"></script>
    <!--  bootstrap-datetimepicker -->
    <script src="/js/bootstrap-datetimepicker.min.js"></script>
    <script src="/pages/jquery.forms-advanced.js"> </script>

    <script src="/plugins/apexcharts/apexcharts.min.js"></script>
    <script src="https://apexcharts.com/samples/assets/irregular-data-series.js"></script>
    <script src="https://apexcharts.com/samples/assets/ohlc.js"></script>
    <script src="/pages/jquery.apexcharts.init.js"></script>

    <!-- Sweet-Alert  -->
    <script src="/plugins/sweet-alert2/sweetalert2.min.js"></script>

    <!-- Required datatable js -->
    <script src="/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="/plugins/datatables/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="/plugins/datatables/dataTables.buttons.min.js"></script>
    <script src="/plugins/datatables/buttons.bootstrap4.min.js"></script>
    <script src="/plugins/datatables/jszip.min.js"></script>
    <script src="/plugins/datatables/pdfmake.min.js"></script>
    <script src="/plugins/datatables/vfs_fonts.js"></script>
    <script src="/plugins/datatables/buttons.html5.min.js"></script>
    <script src="/plugins/datatables/buttons.print.min.js"></script>
    <script src="/plugins/datatables/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="/plugins/datatables/dataTables.responsive.min.js"></script>
    <script src="/plugins/datatables/responsive.bootstrap4.min.js"></script>
    {# <script src="/pages/jquery.datatable.init.js"></script> #}
    
    <script>
        //Buttons examples
        var table = $('#datatable-buttons').DataTable({
            //sDom: 'lrtip',
            searching: false, 
            paging: false, 
            info: false,
            ordering: false,
            lengthChange: false,
            //buttons: ['copy', 'excel', 'pdf', 'colvis']
            buttons: ['excel', 'pdf']
        });
        table.buttons().container().appendTo('#datatable-buttons_wrapper .col-md-6:eq(0)');
        $('#histo').click(function(){
            $(this).parent().addClass('d-none');
            $('.rowFact').addClass('d-none');
            $('.rowHisto').removeClass('d-none');
            $('#fact').parent().removeClass('d-none');
        })
        
        $('#fact').click(function(){
            $(this).parent().addClass('d-none');
            $('.rowHisto').addClass('d-none');
            $('.rowFact').removeClass('d-none');
            $('#histo').parent().removeClass('d-none');
        })
                
    </script>

    <script>
        
        var urlBilling = "{{ path('update_bill') }}";
        
        $('#daterangebilling').on('apply.daterangepicker', function (ev, picker) {
            //console.log(picker.startDate.format('YYYY-MM-DD'));
            //console.log(picker.endDate.format('YYYY-MM-DD'));
        
            startDate = picker.startDate.format('YYYY-MM-DD');
            endDate = picker.endDate.format('YYYY-MM-DD');
            
            console.log('startDate = ' + startDate);
            console.log('endDate = ' + endDate);
            updateBilling();
            // block of code that runs when the click event triggers
        });
                
        function updateBilling(){
            
            $data = JSON.stringify({
                //"selectedDate": $dat,
                "startDate": startDate + ' 00:00:00',
                "endDate": endDate + ' 23:59:59',
                //"type": "zone",
                "id":{{smartMod.id ?? 0}},
                "zoneId": {{zone.id}},
            });
            // Danger
            swal.queue([{
                title: 'The Bill will be updated for the date range :',
                confirmButtonText: 'Confirm',
                text: 'From ' + startDate + ' To ' + endDate,
                showCancelButton: true,
                showLoaderOnConfirm: true,
                confirmButtonClass: 'btn btn-primary',
                cancelButtonClass: 'btn btn-danger ml-2',
                preConfirm: function () {
                    return new Promise(function (resolve) { 
                        
                        $.ajax({
                            type: "POST", // method type
                            contentType: "application/json; charset=utf-8",
                            url: urlBilling, // /Target function that will be return result
                            data: $data, // parameter pass data is parameter name param is value
                            dataType: "json",
                            timeout: 120000, // 64241
                            success: function (result) {
                                // $('.fa-sync').removeClass('fa-spin');
                                console.log(result);
                                
                                swal({
                                    type: 'success', 
                                    title: 'The Bill have been updated !',
                                    // html: 'Submitted email: ' + email
                                });
                                setTimeout(function () {
                                    resolve()
                                }, 2000);
                                if( Object.keys(result).length > 0 ){
                                    //var dateLabel = Object.values(result['date']);
                                    //console.log(Object.values(result['CourbeCroisé']));
                                    //console.log(result);
                                    {# console.log(Object.values(result['SymI']));
                                    console.log(Object.values(result['SymV'])); #}
                                    $('#PF').text(result['FP']); 
                                    $('#NHU_Psous').text(result['NHU_Psous']); 
                                    $('#NHU_Grid').text(result['NHU_Grid']); 
                                    $('#NHU_GE').text(result['NHU_FUEL']); 
                                    $('#DuréeDépassement').text(result['NHD_Psous']); 
                                    $('#SmaxLue').text(result['Smax']); 
                                    $('#EAP').text(result['EAP']); 
                                    $('#EAP_Amount').text(result['amountEAP']); 
                                    $('#EAHP').text(result['EAHP']); 
                                    $('#EAHP_Amount').text(result['amountEAHP']); 
                                    $('#sTotal').text(result['amountEA']);
                                    var prime = parseFloat($('#primeFixe').text());
                                    console.log("Prime Fixe = " + prime);
                                    var amountHT = parseFloat(result['amountEA']) + prime;
                                     
                                    $('#Amount_HT').text(amountHT.toFixed(2)); 
                                    var taxes = (amountHT*{{zone.site.tarification.tva}})/100.0;
                                    $('#taxes').text(taxes.toFixed(2)); 
                                    var amountTTC = amountHT + taxes;
                                    $('#Amount_TTC').text(amountTTC.toFixed(2)); 
                                                                        
                                    
                                }
                            },
                            error: function (result) {
                                // console.log("Error");
                                // console.log(result);
                                swal('Oops...', 'Something went wrong!', 'error'
                                // footer: '<a href>Why do I have this issue?</a>'
                                );
                                setTimeout(function () {
                                    resolve()
                                }, 5000);
                            }
                        });
                    })
                },
                allowOutsideClick: false
            }]);
        }
    </script>
    
    {# <script src="/pages/jquery.crypto-dashboard.init.js"></script> #}
    {# Overview panel script #}
    <script>
        var options = {
            chart: {
                height: 320,
                type: 'pie',
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            series: [{% for smartMod in zone.smartMods %}{% if smartMod.modType ==  'Load Meter' %}{{ random(0, 0) }}{% if loop.last == false %},{% endif %}{% endif %}{% endfor %}],
            labels: [{% for smartMod in zone.smartMods %}{% if smartMod.modType ==  'Load Meter' %}"{{smartMod.name}}"{% if loop.last == false %},{% endif %}{% endif %}{% endfor %}],
            //colors: ["#a3cae0", "#232f5b","#f06a6c", "#f1e299", "#08aeb0"],
            legend: {
                show: true,
                position: 'bottom',
                horizontalAlign: 'center',
                verticalAlign: 'middle',
                floating: false,
                fontSize: '14px',
                offsetX: 0,
                offsetY: -10
            },
            tooltip: {
                theme: "dark",
                style: {
                    color: '#fff',
                }
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    chart: {
                        height: 240
                    },
                    legend: {
                        show: false
                    },
                }
            }]
        }
        var ActiveEnergy_Piechart_overview = new ApexCharts(
            document.querySelector("#apex_pie_active_energy_flow_overview"),
            options
        );
        ActiveEnergy_Piechart_overview.render();
        
        var options = {
            chart: {
                height: 320,
                type: 'pie',
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            series: [{% for smartMod in zone.smartMods %}{% if smartMod.modType ==  'Load Meter' %}{{ random(0, 0) }}{% if loop.last == false %},{% endif %}{% endif %}{% endfor %}],
            labels: [{% for smartMod in zone.smartMods %}{% if smartMod.modType ==  'Load Meter' %}"{{smartMod.name}}"{% if loop.last == false %},{% endif %}{% endif %}{% endfor %}],
            //colors: ["#a3cae0", "#232f5b","#f06a6c", "#f1e299", "#08aeb0"],
            legend: {
                show: true,
                position: 'bottom',
                horizontalAlign: 'center',
                verticalAlign: 'middle',
                floating: false,
                fontSize: '14px',
                offsetX: 0,
                offsetY: -10
            },
            tooltip: {
                theme: "dark",
                style: {
                    color: '#fff',
                },
                
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    chart: {
                        height: 240
                    },
                    legend: {
                        show: false
                    },
                }
            }]
        }
        var ReactiveEnergy_Piechart_overview = new ApexCharts(
            document.querySelector("#apex_pie_reactive_energy_flow_overview"),
            options
        );
        ReactiveEnergy_Piechart_overview.render();
                
        {% if zone.type == 'PUE Calculation' %}
        //Mixed IT Active Power Zone - Active Power Equipments - PUE charts
        var options = {
            chart: {
                height: 380,
                type: 'line',
                stacked: false,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        position: 'top', // top, center, bottom
                    },
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: [2, 2, 2],
                curve: 'smooth'
            },
            noData: {
                text: 'Data not yet available',
                align: 'center',
                verticalAlign: 'middle',
                offsetX: 0,
                offsetY: 0,
                style: {
                    color: undefined,
                    fontSize: '14px',
                    fontFamily: undefined
                }
            },
            series: [{
                name: 'IT Power',
                type: 'line',
                data: []
                //data: [1.4, 2, 2.5, 1.5, 2.5, 2.8, 3.8, 4.6]
            }, {
                name: 'DataCenter Power',
                type: 'line',
                data: []
                //data: [1.1, 3, 3.1, 4, 4.1, 4.9, 6.5, 8.5]
            }, {
                name: 'PUE',
                type: 'line',
                data: []
                //data: [1.20, 1.829, 1.37, 1.36, 1.44, 1.45, 1.50, 1.58]
            }],
            fill: {
                opacity: [1, 1, 1],
                gradient: {
                    inverseColors: false,
                    shade: 'light',
                    type: "vertical",
                    opacityFrom: 0.85,
                    opacityTo: 0.55,
                    stops: [0, 100, 100, 100]
                }
            },
            colors: ["#fbb624", "#77d0ba", "#e02040"], //
            xaxis: {
                type: 'datetime',
                categories: [],
                //categories: [2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016],
                labels: {
                    datetimeFormatter: {
                        year: 'yyyy',
                        month: 'MMM \'yy',
                        day: 'dd MMM',
                        hour: 'HH:mm'
                    }
                },
                title: {
                    text: moment().format('DD MMMM').toString(),
                    style: {
                        fontSize: '14px',
                        fontWeight: 'bold',
                        fontFamily: undefined,
                        color: '#444'
                    },
                }
            },
            yaxis: [
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#fbb624'
                    },
                    labels: {
                        style: {
                            color: '#fbb624',
                        }
                    },
                    title: {
                        text: "IT Power (kW)"
                    },
                },
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#77d0ba'
                    },
                    labels: {
                        style: {
                            color: '#77d0ba',
                        },
                        offsetX: 10
                    },
                    title: {
                        text: "DataCenter Power (kW)",
                    },
                },
                {
                    opposite: true,
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#e02040'
                    },
                    labels: {
                        style: {
                            color: '#e02040',
                        }
                    },
                    title: {
                        text: "PUE"
                    }
                },
            ],
            tooltip: {
                theme: "dark",
                followCursor: true,
                y: {
                    formatter: function (y) {
                        if (typeof y !== "undefined") {
                            return y.toFixed(2)
                        } 
                        return y;
                    }
                },
                x: {
                    formatter: function (val, timestamp) {
                        return moment(new Date(val)).format("DD MMM YYYY")
                    }
                }
            },
            grid: {
                borderColor: '#f1f3fa'
            },
            legend: {
                offsetY: -10,
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    yaxis: {
                        show: false
                    },
                    legend: {
                        show: false
                    }
                }
            }]
        }
        
        var Mixed_Pue_Power_Linechart_overview = new ApexCharts(
            document.querySelector("#apex_mixed_pue_power_overview"),
            options
        );
        Mixed_Pue_Power_Linechart_overview.render();

        //Mixed Temperature Indoor-Outdoor - Humidity Indoor-Outdoor
        var options = {
            chart: {
                height: 380,
                type: 'line',
                stacked: false,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        position: 'top', // top, center, bottom
                    },
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: [2, 2, 2, 2],
                curve: 'smooth'
            },
            noData: {
                text: 'Data not yet available',
                align: 'center',
                verticalAlign: 'middle',
                offsetX: 0,
                offsetY: 0,
                style: {
                    color: undefined,
                    fontSize: '14px',
                    fontFamily: undefined
                }
            },
            series: [{
                name: 'Temperature Indoor',
                type: 'line',
                data: []
                //data: [25, 24.8, 25.2, 25.8, 25.4, 25.6, 25.1, 25.7]
            }, {
                name: 'Temperatue Outdoor',
                type: 'line',
                data: []
                //data: [28, 30.1, 29.3, 29.5, 28.7, 29.7, 30.5, 31]
            }, {
                name: 'Humidity Indoor',
                type: 'line',
                data: []
                //data: [84, 90, 94, 97, 95, 93, 80, 82]
            }, {
                name: 'Humidity Outdoor',
                type: 'line',
                data: []
                //data: [90, 84, 97, 94, 93, 95, 84, 87]
            }],
            fill: {
                opacity: [1, 1, 1, 1],
                gradient: {
                    inverseColors: false,
                    shade: 'light',
                    type: "vertical",
                    opacityFrom: 0.85,
                    opacityTo: 0.55,
                    stops: [0, 100, 100, 100]
                }
            },
            colors: ["rgb(0, 143, 251)","#fbb624", "#77d0ba", "#e02040"], //
            xaxis: {
                type: 'datetime',
                categories: [],
                //categories: [2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016],
                labels: {
                    datetimeFormatter: {
                        year: 'yyyy',
                        month: 'MMM \'yy',
                        day: 'dd MMM',
                        hour: 'HH:mm'
                    }
                },
                title: {
                    text: moment().format('DD MMMM').toString(),
                    style: {
                        fontSize: '14px',
                        fontWeight: 'bold',
                        fontFamily: undefined,
                        color: '#444'
                    },
                }
            },
            yaxis: [
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: 'rgb(0, 143, 251)'
                    },
                    labels: {
                        style: {
                            color: 'rgb(0, 143, 251)',
                        }
                    },
                    title: {
                        text: "Temperature Indoor (°C)"
                    },
                },
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#fbb624'
                    },
                    labels: {
                        style: {
                            color: '#fbb624',
                        }
                    },
                    title: {
                        text: "Temperature Outdoor (°C)"
                    },
                },
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#77d0ba'
                    },
                    labels: {
                        style: {
                            color: '#77d0ba',
                        },
                        offsetX: 10
                    },
                    title: {
                        text: "Humidity Indoor (%)",
                    },
                },
                {
                    opposite: true,
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#e02040'
                    },
                    labels: {
                        style: {
                            color: '#e02040',
                        }
                    },
                    title: {
                        text: "Humidity Outdoor (%)"
                    }
                },
            ],
            tooltip: {
                theme: "dark",
                followCursor: true,
                y: {
                    formatter: function (y) {
                        if (typeof y !== "undefined") {
                            return y.toFixed(2)
                        } 
                        return y;
                    }
                },
                x: {
                    formatter: function (val, timestamp) {
                        return moment(new Date(val)).format("DD MMM YYYY HH:mm:ss")
                    }
                }
            },
            grid: {
                borderColor: '#f1f3fa'
            },
            legend: {
                offsetY: -10,
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    yaxis: {
                        show: false
                    },
                    legend: {
                        show: false
                    }
                }
            }]
        }
        
        var Mixed_Climate_Linechart_overview = new ApexCharts(
            document.querySelector("#apex_mixed_climate_overview"),
            options
        );
        Mixed_Climate_Linechart_overview.render();

        //Mixed Energy charts
        var options = {
            chart: {
                height: 380,
                type: 'line',
                stacked: false,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        position: 'top', // top, center, bottom
                    },
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: [2, 2, 2],
                curve: 'smooth'
            },
            noData: {
                text: 'Data not yet available',
                align: 'center',
                verticalAlign: 'middle',
                offsetX: 0,
                offsetY: 0,
                style: {
                    color: undefined,
                    fontSize: '14px',
                    fontFamily: undefined
                }
            },
            series: [{
                name: 'Active Energy of {{zone.name}}',
                type: 'column',
                data: []
                //data: [1.4, 2, 2.5, 1.5, 2.5, 2.8, 3.8, 4.6]
            }, {
                name: 'Active Energy of Production equipments',
                type: 'column',
                data: []
                //data: [1.1, 3, 3.1, 4, 4.1, 4.9, 6.5, 8.5]
            }, {
                name: 'Interval PUE',
                type: 'area',
                data: []
                //data: [20, 29, 37, 36, 44, 45, 50, 58]
            }],
            fill: {
                opacity: [1, 1, 0.25],
                gradient: {
                    inverseColors: false,
                    shade: 'light',
                    type: "vertical",
                    opacityFrom: 0.85,
                    opacityTo: 0.55,
                    stops: [0, 100, 100, 100]
                }
            },
            colors: ["#fbb624", "#77d0ba", "#e02040"],
            xaxis: {
                type: 'datetime',
                categories: [],
                //categories: [2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016],
                labels: {
                    datetimeFormatter: {
                        year: 'yyyy',
                        month: 'MMM \'yy',
                        day: 'dd MMM',
                        hour: 'HH:mm'
                    }
                },
                title: {
                    text: moment().format('DD MMMM').toString(),
                    style: {
                        fontSize: '14px',
                        fontWeight: 'bold',
                        fontFamily: undefined,
                        color: '#444'
                    },
                }
            },
            yaxis: [
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#fbb624'
                    },
                    labels: {
                        style: {
                            color: '#fbb624',
                        }
                    },
                    title: {
                        text: "Active Energy of {{zone.name}} (kWh)"
                    },
                },
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#77d0ba'
                    },
                    labels: {
                        style: {
                            color: '#77d0ba',
                        },
                        offsetX: 10
                    },
                    title: {
                        text: "Active Energy of Production Equipments (kWh)",
                    },
                },
                {
                    opposite: true,
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#e02040'
                    },
                    labels: {
                        style: {
                            color: '#e02040',
                        }
                    },
                    title: {
                        text: "Interval PUE"
                    }
                },
            ],
            tooltip: {
                theme: "dark",
                followCursor: true,
                y: {
                    formatter: function (y) {
                        if (typeof y !== "undefined") {
                            return y.toFixed(2) + ""
                        } 
                        return y;
                    }
                },
                x: {
                    formatter: function (val, timestamp) {
                        return moment(new Date(val)).format("DD MMM YYYY")
                    }
                }
            },
            grid: {
                borderColor: '#f1f3fa'
            },
            legend: {
                offsetY: -10,
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    yaxis: {
                        show: false
                    },
                    legend: {
                        show: false
                    }
                }
            }]
        }
        var Mixed_Pue_Energy_Linechart_overview = new ApexCharts(
            document.querySelector("#apex_mixed_pue_energy_overview"),
            options
        );
        Mixed_Pue_Energy_Linechart_overview.render();
        {% else %}
            //Mixed Apparent Power - Active Power - Cosphi charts
        var options = {
            chart: {
                height: 380,
                type: 'line',
                stacked: false,
                toolbar: {
                    show: true
                }
            },
            stroke: {
                width: [2, 2, 2],
                curve: 'smooth'
            },
            noData: {
                text: 'Data not yet available',
                align: 'center',
                verticalAlign: 'middle',
                offsetX: 0,
                offsetY: 0,
                style: {
                    color: undefined,
                    fontSize: '14px',
                    fontFamily: undefined
                }
            },
            plotOptions: {
                bar: {
                    columnWidth: '50%'
                }
            },
            colors: ["#1ecab8", "#fbb624", "#f93b7a"],
            series: [{
                name: 'Apparent Power',
                type: 'line',
                //data: [23, 11, 22, 27, 13, 22, 37, 21, 44, 22, 30]
                data: []
            }, {
                name: 'Active Power',
                type: 'line',
                //data: [44, 55, 41, 67, 22, 43, 21, 41, 56, 27, 43]
                data: []
            }, {
                name: 'CosPhi',
                type: 'line',
                //data: [30, 25, 36, 30, 45, 35, 64, 52, 59, 36, 39]
                data: []
            }],
            fill: {
                opacity: [1, 1, 1],
                gradient: {
                    inverseColors: false,
                    shade: 'light',
                    type: "vertical",
                    opacityFrom: 0.85,
                    opacityTo: 0.55,
                    stops: [0, 100, 100, 100]
                }
            },
            //labels: ['01/01/2003', '02/01/2003', '03/01/2003', '04/01/2003', '05/01/2003', '06/01/2003', '07/01/2003', '08/01/2003', '09/01/2003', '10/01/2003', '11/01/2003'],
            labels: [],
            markers: {
                size: 0
            },
            legend: {
                offsetY: -10,
                position: 'bottom',
            },
            xaxis: {
                type: 'datetime',
                categories: [],
                labels: {
                    datetimeFormatter: {
                        year: 'yyyy',
                        month: 'MMM \'yy',
                        day: 'dd MMM',
                        hour: 'HH:mm'
                    }
                },
                title: {
                    text: moment().format('DD MMMM YYYY').toString(),
                    style: {
                        fontSize: '14px',
                        fontWeight: 'bold',
                        fontFamily: undefined,
                        color: '#444'
                    },
                }
            },
            yaxis: [
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#1ecab8'
                    },
                    labels: {
                        style: {
                            color: '#1ecab8',
                        }
                    },
                    title: {
                        text: "kVA"
                    },
                },

                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#fbb624'
                    },
                    labels: {
                        style: {
                            color: '#fbb624',
                        },
                        offsetX: 10
                    },
                    title: {
                        text: "kW",
                    },
                },
                {
                    opposite: true,
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#f93b7a'
                    },
                    labels: {
                        style: {
                            color: '#f93b7a',
                        }
                    },
                    title: {
                        text: ""
                    }
                },

            ],    
            tooltip: {
                shared: true,
                intersect: false,
                theme: "dark",
                y: {
                    formatter: function (y) {
                        if (typeof y !== "undefined") {
                            return y.toFixed(2) + "";
                        }
                        return y;

                    }
                },
                x: {
                    formatter: function (val, timestamp) {
                        return moment(new Date(val)).format("DD MMM YYYY HH:mm")
                    }
                }
            },
            grid: {
                borderColor: '#f1f3fa'
            }
        }
        
        var Mixed_PSCosfi_Linechart_overview = new ApexCharts(
            document.querySelector("#apex_mixed_PSCosfi_overview"),
            options
        );

        Mixed_PSCosfi_Linechart_overview.render();
        {% endif %}
        
        var url_ = "{{ path('update_zone_overview_graphs') }}";
        {# console.log('startDate = '+moment().format("YYYY-MM-DD") + ' 00:00:00')
        console.log('endDate = '+moment().format("YYYY-MM-DD") + ' 00:00:00') #}
        var $data_ = JSON.stringify({
            "startDate": moment().format("YYYY-MM-DD") + ' 00:00:00',
            "endDate": moment().format("YYYY-MM-DD") + ' 23:59:59',
            "zoneId": {{zone.id}},
        });
        setTimeout(
            function(){ 
                swal.queue([{
                    title: 'Waiting...',
                    confirmButtonText: 'Confirm',
                    text: 'Please wait !',
                    //showCancelButton: true,
                    showLoaderOnConfirm: true,
                    //confirmButtonClass: 'btn btn-primary',
                    //cancelButtonClass: 'btn btn-danger ml-2',
                    preConfirm: function () {
                        return new Promise(function (resolve) { 
                            $.ajax({
                                type: "POST", // method type
                                contentType: "application/json; charset=utf-8",
                                url: url_, // /Target function that will be return result
                                data: $data_, // parameter pass data is parameter name param is value
                                dataType: "json",
                                timeout: 120000, // 64241
                                success: function (result) {
                                    // $('.fa-sync').removeClass('fa-spin');
                                    console.log(result);
                                    
                                    swal({
                                        type: 'success', 
                                        title: 'The graphs have been updated !',
                                        // html: 'Submitted email: ' + email
                                    });
                                    setTimeout(function () {
                                        resolve()
                                    }, 2000);
                                    if( Object.keys(result).length > 0 ){
                                        var dateLabel = Object.values(result['date']);
                                        console.log(result);
                                        console.log(Object.values(result['PieActiveEnergy']));
                                        {% for smartMod in zone.smartMods %}
                                            {% if smartMod.modType ==  'Load Meter' %}
                                            $('#p_{{smartMod.id}}_overview').text(Object.values(result['P'])[{{loop.index0}}])
                                            $('#s_{{smartMod.id}}_overview').text(Object.values(result['S'])[{{loop.index0}}])
                                            $('#fp_{{smartMod.id}}_overview').text(Object.values(result['FP'])[{{loop.index0}}])
                                            {% endif %}
                                        {% endfor %}
                                        
                                        //displayPieNewData(ActiveEnergy_Piechart, dateLabel, Object.values(result['PieActiveEnergy']), [startDate, endDate], {{ zone.smartMods|length }}, 'day');
                                        //displayPieNewData(ReactiveEnergy_Piechart, dateLabel, Object.values(result['PieReactiveEnergy']), [startDate, endDate], {{ zone.smartMods|length }}, 'day');
                                        
                                        if(result['Date1'] !== '') $('#update').text(String( moment( new Date(result['Date1']) ).format("DD MMM YYYY HH:mm:ss")) )

                                        {% if zone.type == 'PUE Calculation' %}     
                                        $("#instPUE").text(result['InstantPUE']);
                                        //$("#intPUE").text(result['IntervalPUE']);
                                        //console.log(Object.values(result['climateDate']));
                                        var dataLabel = Object.values(result['date']);
                                        displayNewData(Mixed_Pue_Power_Linechart_overview, dateLabel, Object.values(result['PUE']), [startDate, endDate], 3, 'day');
                                        displayNewData(Mixed_Climate_Linechart_overview, Object.values(result['climateDate']), Object.values(result['MixedClimate']), [moment().format("DD MMM YYYY"), moment().format("DD MMM YYYY")], 4, 'day');
                                        displayNewData(Mixed_Pue_Energy_Linechart_overview, dateLabel, Object.values(result['MixedEnergy']), [moment().format("DD MMM YYYY"), moment().format("DD MMM YYYY")], 3, 'day');
                                        {% else %}
                                        displayNewData(Mixed_PSCosfi_Linechart_overview, Object.values(result['datePSCosfi']), Object.values(result['MixedPSCosfi']), [moment().format("DD MMM YYYY"), moment().format("DD MMM YYYY")], 3, 'day');
                                        {% endif %}

                                        var dataArray = [{% for smartMod in zone.smartMods %}
                                            {% if smartMod.modType ==  'Load Meter' %}parseFloat(Object.values(result['PieActiveEnergy'])[{{loop.index0}}]){% if loop.last == false %},{% endif %}{% endif %}
                                            {% endfor %}
                                        ];
                                        updateDonutChart(ActiveEnergy_Piechart_overview, [{% for smartMod in zone.smartMods %}
                                            {% if smartMod.modType ==  'Load Meter' %}String("{{smartMod.name}} : " + parseFloat(Object.values(result['PieActiveEnergy'])[{{loop.index0}}]) + " kWh"){% if loop.last == false %},{% endif %}{% endif %}
                                            {% endfor %}
                                        ], dataArray);
                                        dataArray = [{% for smartMod in zone.smartMods %}
                                            {% if smartMod.modType ==  'Load Meter' %}parseFloat(Object.values(result['PieReactiveEnergy'])[{{loop.index0}}]){% if loop.last == false %},{% endif %}{% endif %}
                                            {% endfor %}
                                        ];
                                        updateDonutChart(ReactiveEnergy_Piechart_overview, [{% for smartMod in zone.smartMods %}
                                            {% if smartMod.modType ==  'Load Meter' %}String("{{smartMod.name}} : " + parseFloat(Object.values(result['PieReactiveEnergy'])[{{loop.index0}}]) + " kVAR"){% if loop.last == false %},{% endif %}{% endif %}
                                            {% endfor %}
                                        ], dataArray);
                                    }
                                },
                                error: function (result) {
                                    // console.log("Error");
                                    // console.log(result);
                                    swal('Oops...', 'Something went wrong!', 'error'
                                    // footer: '<a href>Why do I have this issue?</a>'
                                    );
                                    setTimeout(function () {
                                        resolve()
                                    }, 5000);
                                }
                            });
                        })
                    },
                    allowOutsideClick: false
                }]);

                $(".swal2-confirm").click();
                //alert("Hello"); 
                    
            }
        , 500);

        setInterval(function () {
            $.ajax({
                type: "POST", // method type
                contentType: "application/json; charset=utf-8",
                url: url_, // /Target function that will be return result
                data: $data_, // parameter pass data is parameter name param is value
                dataType: "json",
                timeout: 120000, // 64241
                success: function (result) {
                    // $('.fa-sync').removeClass('fa-spin');
                    console.log(result);
                    
                    if( Object.keys(result).length > 0 ){
                        var dateLabel = Object.values(result['date']);
                        {# console.log(result); #}
                        console.log(Object.values(result['PieActiveEnergy']));
                        $('#p_overview').text(Object.values(result['P']))
                        $('#s_overview').text(Object.values(result['S']))
                        $('#fp_overview').text(Object.values(result['FP']))
                        {# {% for smartMod in zone.smartMods %}
                            {% if smartMod.modType ==  'Load Meter' %}
                            $('#p_{{smartMod.id}}_overview').text(Object.values(result['P'])[{{loop.index0}}])
                            $('#s_{{smartMod.id}}_overview').text(Object.values(result['S'])[{{loop.index0}}])
                            $('#fp_{{smartMod.id}}_overview').text(Object.values(result['FP'])[{{loop.index0}}])
                            {% endif %}
                        {% endfor %} #}
                        
                        //displayPieNewData(ActiveEnergy_Piechart, dateLabel, Object.values(result['PieActiveEnergy']), [startDate, endDate], {{ zone.smartMods|length }}, 'day');
                        //displayPieNewData(ReactiveEnergy_Piechart, dateLabel, Object.values(result['PieReactiveEnergy']), [startDate, endDate], {{ zone.smartMods|length }}, 'day');
                        
                        if(result['Date1'] !== '') $('#update').text(String( moment( new Date(result['Date1']) ).format("DD MMM YYYY HH:mm:ss")) )
                    
                        {% if zone.type == 'PUE Calculation' %}     
                        $("#instPUE").text(result['InstantPUE']);
                        //$("#intPUE").text(result['IntervalPUE']);
                        //console.log(Object.values(result['climateDate']));
                        displayNewData(Mixed_Pue_Power_Linechart_overview, dateLabel, Object.values(result['PUE']), [startDate, endDate], 3, 'day');
                        displayNewData(Mixed_Climate_Linechart_overview, Object.values(result['climateDate']), Object.values(result['MixedClimate']), [moment().format("DD MMM YYYY"), moment().format("DD MMM YYYY")], 4, 'day');
                        displayNewData(Mixed_Pue_Energy_Linechart_overview, dateLabel, Object.values(result['MixedEnergy']), [moment().format("DD MMM YYYY"), moment().format("DD MMM YYYY")], 3, 'day');
                        {% else %}
                        displayNewData(Mixed_PSCosfi_Linechart_overview, Object.values(result['datePSCosfi']), Object.values(result['MixedPSCosfi']), [moment().format("DD MMM YYYY"), moment().format("DD MMM YYYY")], 3, 'day');
                        {% endif %}

                        var dataArray = [{% for smartMod in zone.smartMods %}
                            {% if smartMod.modType ==  'Load Meter' %}parseFloat(Object.values(result['PieActiveEnergy'])[{{loop.index0}}]){% if loop.last == false %},{% endif %}{% endif %}
                            {% endfor %}
                        ];
                        updateDonutChart(ActiveEnergy_Piechart_overview, [{% for smartMod in zone.smartMods %}
                            {% if smartMod.modType ==  'Load Meter' %}String("{{smartMod.name}} : " + parseFloat(Object.values(result['PieActiveEnergy'])[{{loop.index0}}]) + " kWh"){% if loop.last == false %},{% endif %}{% endif %}
                            {% endfor %}
                        ], dataArray);
                        dataArray = [{% for smartMod in zone.smartMods %}
                            {% if smartMod.modType ==  'Load Meter' %}parseFloat(Object.values(result['PieReactiveEnergy'])[{{loop.index0}}]){% if loop.last == false %},{% endif %}{% endif %}
                            {% endfor %}
                        ];
                        updateDonutChart(ReactiveEnergy_Piechart_overview, [{% for smartMod in zone.smartMods %}
                            {% if smartMod.modType ==  'Load Meter' %}String("{{smartMod.name}} : " + parseFloat(Object.values(result['PieReactiveEnergy'])[{{loop.index0}}]) + " kVAR"){% if loop.last == false %},{% endif %}{% endif %}
                            {% endfor %}
                        ], dataArray);
                    }
                },
                error: function (result) {
                    console.log("Something went wrong!");
                    // console.log(result);
                }
            });
        }, 120000);
    </script>

    {# Historical panel script #}
    <script>
        var options = {
            chart: {
                height: 320,
                type: 'pie',
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            series: [{% for smartMod in zone.smartMods %}{% if smartMod.modType ==  'Load Meter' %}{{ random(0, 0) }}{% if loop.last == false %},{% endif %}{% endif %}{% endfor %}],
            labels: [{% for smartMod in zone.smartMods %}{% if smartMod.modType ==  'Load Meter' %}"{{smartMod.name}}"{% if loop.last == false %},{% endif %}{% endif %}{% endfor %}],
            //colors: ["#a3cae0", "#232f5b","#f06a6c", "#f1e299", "#08aeb0"],
            legend: {
                show: true,
                position: 'bottom',
                horizontalAlign: 'center',
                verticalAlign: 'middle',
                floating: false,
                fontSize: '14px',
                offsetX: 0,
                offsetY: -10
            },
            tooltip: {
                theme: "dark",
                style: {
                    color: '#fff',
                }
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    chart: {
                        height: 240
                    },
                    legend: {
                        show: false
                    },
                }
            }]
        }
        var ActiveEnergy_Piechart = new ApexCharts(
            document.querySelector("#apex_pie_active_energy_flow"),
            options
        );
        ActiveEnergy_Piechart.render();
        
        var options = {
            chart: {
                height: 320,
                type: 'pie',
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            series: [{% for smartMod in zone.smartMods %}{% if smartMod.modType ==  'Load Meter' %}{{ random(0, 0) }}{% if loop.last == false %},{% endif %}{% endif %}{% endfor %}],
            labels: [{% for smartMod in zone.smartMods %}{% if smartMod.modType ==  'Load Meter' %}"{{smartMod.name}}"{% if loop.last == false %},{% endif %}{% endif %}{% endfor %}],
            //colors: ["#a3cae0", "#232f5b","#f06a6c", "#f1e299", "#08aeb0"],
            legend: {
                show: true,
                position: 'bottom',
                horizontalAlign: 'center',
                verticalAlign: 'middle',
                floating: false,
                fontSize: '14px',
                offsetX: 0,
                offsetY: -10
            },
            tooltip: {
                theme: "dark",
                style: {
                    color: '#fff',
                },
                
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    chart: {
                        height: 240
                    },
                    legend: {
                        show: false
                    },
                }
            }]
        }
        var ReactiveEnergy_Piechart = new ApexCharts(
            document.querySelector("#apex_pie_reactive_energy_flow"),
            options
        );
        ReactiveEnergy_Piechart.render();
                
        {% if zone.type == 'PUE Calculation' %}
        //Mixed IT Active Power Zone - Active Power Equipments - PUE charts
        var options = {
            chart: {
                height: 380,
                type: 'line',
                stacked: false,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        position: 'top', // top, center, bottom
                    },
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: [2, 2, 2],
                curve: 'smooth'
            },
            noData: {
                text: 'Data not yet available',
                align: 'center',
                verticalAlign: 'middle',
                offsetX: 0,
                offsetY: 0,
                style: {
                    color: undefined,
                    fontSize: '14px',
                    fontFamily: undefined
                }
            },
            series: [{
                name: 'IT Power',
                type: 'line',
                data: []
                //data: [1.4, 2, 2.5, 1.5, 2.5, 2.8, 3.8, 4.6]
            }, {
                name: 'DataCenter Power',
                type: 'line',
                data: []
                //data: [1.1, 3, 3.1, 4, 4.1, 4.9, 6.5, 8.5]
            }, {
                name: 'PUE',
                type: 'line',
                data: []
                //data: [1.20, 1.829, 1.37, 1.36, 1.44, 1.45, 1.50, 1.58]
            }],
            fill: {
                opacity: [1, 1, 1],
                gradient: {
                    inverseColors: false,
                    shade: 'light',
                    type: "vertical",
                    opacityFrom: 0.85,
                    opacityTo: 0.55,
                    stops: [0, 100, 100, 100]
                }
            },
            colors: ["#fbb624", "#77d0ba", "#e02040"], //
            xaxis: {
                type: 'datetime',
                categories: [],
                //categories: [2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016],
                labels: {
                    datetimeFormatter: {
                        year: 'yyyy',
                        month: 'MMM \'yy',
                        day: 'dd MMM',
                        hour: 'HH:mm'
                    }
                },
                title: {
                    text: moment().format('DD MMMM').toString(),
                    style: {
                        fontSize: '14px',
                        fontWeight: 'bold',
                        fontFamily: undefined,
                        color: '#444'
                    },
                }
            },
            yaxis: [
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#fbb624'
                    },
                    labels: {
                        style: {
                            color: '#fbb624',
                        }
                    },
                    title: {
                        text: "IT Power (kW)"
                    },
                },
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#77d0ba'
                    },
                    labels: {
                        style: {
                            color: '#77d0ba',
                        },
                        offsetX: 10
                    },
                    title: {
                        text: "DataCenter Power (kW)",
                    },
                },
                {
                    opposite: true,
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#e02040'
                    },
                    labels: {
                        style: {
                            color: '#e02040',
                        }
                    },
                    title: {
                        text: "PUE"
                    }
                },
            ],
            tooltip: {
                theme: "dark",
                followCursor: true,
                y: {
                    formatter: function (y) {
                        if (typeof y !== "undefined") {
                            return y.toFixed(2)
                        } 
                        return y;
                    }
                },
                x: {
                    formatter: function (val, timestamp) {
                        return moment(new Date(val)).format("DD MMM YYYY")
                    }
                }
            },
            grid: {
                borderColor: '#f1f3fa'
            },
            legend: {
                offsetY: -10,
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    yaxis: {
                        show: false
                    },
                    legend: {
                        show: false
                    }
                }
            }]
        }
        
        var Mixed_Pue_Power_Linechart = new ApexCharts(
            document.querySelector("#apex_mixed_pue_power"),
            options
        );
        Mixed_Pue_Power_Linechart.render();

        //Mixed Temperature Indoor-Outdoor - Humidity Indoor-Outdoor
        var options = {
            chart: {
                height: 380,
                type: 'line',
                stacked: false,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        position: 'top', // top, center, bottom
                    },
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: [2, 2, 2, 2],
                curve: 'smooth'
            },
            noData: {
                text: 'Data not yet available',
                align: 'center',
                verticalAlign: 'middle',
                offsetX: 0,
                offsetY: 0,
                style: {
                    color: undefined,
                    fontSize: '14px',
                    fontFamily: undefined
                }
            },
            series: [{
                name: 'Temperature Indoor',
                type: 'line',
                data: []
                //data: [25, 24.8, 25.2, 25.8, 25.4, 25.6, 25.1, 25.7]
            }, {
                name: 'Temperatue Outdoor',
                type: 'line',
                data: []
                //data: [28, 30.1, 29.3, 29.5, 28.7, 29.7, 30.5, 31]
            }, {
                name: 'Humidity Indoor',
                type: 'line',
                data: []
                //data: [84, 90, 94, 97, 95, 93, 80, 82]
            }, {
                name: 'Humidity Outdoor',
                type: 'line',
                data: []
                //data: [90, 84, 97, 94, 93, 95, 84, 87]
            }],
            fill: {
                opacity: [1, 1, 1, 1],
                gradient: {
                    inverseColors: false,
                    shade: 'light',
                    type: "vertical",
                    opacityFrom: 0.85,
                    opacityTo: 0.55,
                    stops: [0, 100, 100, 100]
                }
            },
            colors: ["rgb(0, 143, 251)","#fbb624", "#77d0ba", "#e02040"], //
            xaxis: {
                type: 'datetime',
                categories: [],
                //categories: [2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016],
                labels: {
                    datetimeFormatter: {
                        year: 'yyyy',
                        month: 'MMM \'yy',
                        day: 'dd MMM',
                        hour: 'HH:mm'
                    }
                },
                title: {
                    text: moment().format('DD MMMM').toString(),
                    style: {
                        fontSize: '14px',
                        fontWeight: 'bold',
                        fontFamily: undefined,
                        color: '#444'
                    },
                }
            },
            yaxis: [
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: 'rgb(0, 143, 251)'
                    },
                    labels: {
                        style: {
                            color: 'rgb(0, 143, 251)',
                        }
                    },
                    title: {
                        text: "Temperature Indoor (°C)"
                    },
                },
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#fbb624'
                    },
                    labels: {
                        style: {
                            color: '#fbb624',
                        }
                    },
                    title: {
                        text: "Temperature Outdoor (°C)"
                    },
                },
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#77d0ba'
                    },
                    labels: {
                        style: {
                            color: '#77d0ba',
                        },
                        offsetX: 10
                    },
                    title: {
                        text: "Humidity Indoor (%)",
                    },
                },
                {
                    opposite: true,
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#e02040'
                    },
                    labels: {
                        style: {
                            color: '#e02040',
                        }
                    },
                    title: {
                        text: "Humidity Outdoor (%)"
                    }
                },
            ],
            tooltip: {
                theme: "dark",
                followCursor: true,
                y: {
                    formatter: function (y) {
                        if (typeof y !== "undefined") {
                            return y.toFixed(2)
                        } 
                        return y;
                    }
                },
                x: {
                    formatter: function (val, timestamp) {
                        return moment(new Date(val)).format("DD MMM YYYY HH:mm:ss")
                    }
                }
            },
            grid: {
                borderColor: '#f1f3fa'
            },
            legend: {
                offsetY: -10,
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    yaxis: {
                        show: false
                    },
                    legend: {
                        show: false
                    }
                }
            }]
        }
        
        var Mixed_Climate_Linechart = new ApexCharts(
            document.querySelector("#apex_mixed_climate"),
            options
        );
        Mixed_Climate_Linechart.render();

        //Mixed Energy charts
        var options = {
            chart: {
                height: 380,
                type: 'line',
                stacked: false,
                toolbar: {
                    show: true
                }
            },
            plotOptions: {
                bar: {
                    dataLabels: {
                        position: 'top', // top, center, bottom
                    },
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: [2, 2, 2],
                curve: 'smooth'
            },
            noData: {
                text: 'Data not yet available',
                align: 'center',
                verticalAlign: 'middle',
                offsetX: 0,
                offsetY: 0,
                style: {
                    color: undefined,
                    fontSize: '14px',
                    fontFamily: undefined
                }
            },
            series: [{
                name: 'Active Energy of {{zone.name}}',
                type: 'column',
                data: []
                //data: [1.4, 2, 2.5, 1.5, 2.5, 2.8, 3.8, 4.6]
            }, {
                name: 'Active Energy of Production equipments',
                type: 'column',
                data: []
                //data: [1.1, 3, 3.1, 4, 4.1, 4.9, 6.5, 8.5]
            }, {
                name: 'Interval PUE',
                type: 'area',
                data: []
                //data: [20, 29, 37, 36, 44, 45, 50, 58]
            }],
            fill: {
                opacity: [1, 1, 0.25],
                gradient: {
                    inverseColors: false,
                    shade: 'light',
                    type: "vertical",
                    opacityFrom: 0.85,
                    opacityTo: 0.55,
                    stops: [0, 100, 100, 100]
                }
            },
            colors: ["#fbb624", "#77d0ba", "#e02040"],
            xaxis: {
                type: 'datetime',
                categories: [],
                //categories: [2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016],
                labels: {
                    datetimeFormatter: {
                        year: 'yyyy',
                        month: 'MMM \'yy',
                        day: 'dd MMM',
                        hour: 'HH:mm'
                    }
                },
                title: {
                    text: moment().format('DD MMMM').toString(),
                    style: {
                        fontSize: '14px',
                        fontWeight: 'bold',
                        fontFamily: undefined,
                        color: '#444'
                    },
                }
            },
            yaxis: [
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#fbb624'
                    },
                    labels: {
                        style: {
                            color: '#fbb624',
                        }
                    },
                    title: {
                        text: "Active Energy of {{zone.name}} (kWh)"
                    },
                },
                {
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#77d0ba'
                    },
                    labels: {
                        style: {
                            color: '#77d0ba',
                        },
                        offsetX: 10
                    },
                    title: {
                        text: "Active Energy of Production Equipments (kWh)",
                    },
                },
                {
                    opposite: true,
                    axisTicks: {
                        show: true,
                    },
                    axisBorder: {
                        show: true,
                        color: '#e02040'
                    },
                    labels: {
                        style: {
                            color: '#e02040',
                        }
                    },
                    title: {
                        text: "Interval PUE"
                    }
                },
            ],
            tooltip: {
                theme: "dark",
                followCursor: true,
                y: {
                    formatter: function (y) {
                        if (typeof y !== "undefined") {
                            return y.toFixed(2) + ""
                        } 
                        return y;
                    }
                },
                x: {
                    formatter: function (val, timestamp) {
                        return moment(new Date(val)).format("DD MMM YYYY")
                    }
                }
            },
            grid: {
                borderColor: '#f1f3fa'
            },
            legend: {
                offsetY: -10,
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    yaxis: {
                        show: false
                    },
                    legend: {
                        show: false
                    }
                }
            }]
        }
        var Mixed_Pue_Energy_Linechart = new ApexCharts(
            document.querySelector("#apex_mixed_pue_energy"),
            options
        );
        Mixed_Pue_Energy_Linechart.render();
        {% endif %}
        
        var _url = "{{ path('update_zone_graphs') }}";
        var drp = $('#daterange').data('daterangepicker');
        console.log('drp = ' + drp.startDate.format('YYYY-MM-DD'));
        var startDate = drp.startDate.format('YYYY-MM-DD');
        var endDate = drp.endDate.format('YYYY-MM-DD');
        
        $('#daterange').on('apply.daterangepicker', function (ev, picker) {
            //console.log(picker.startDate.format('YYYY-MM-DD'));
            //console.log(picker.endDate.format('YYYY-MM-DD'));
        
            startDate = picker.startDate.format('YYYY-MM-DD');
            endDate = picker.endDate.format('YYYY-MM-DD');
            
            console.log('startDate = ' + startDate);
            console.log('endDate = ' + endDate);
            updateDashboard();
            // block of code that runs when the click event triggers
        });
        
        function displayNewData(chart, label, data, dateopt, multiple, xscale){
            //chart.data.labels = [];
            chart.updateOptions({
                xaxis: {
                    categories: []
                },
            });
            /*chart.updateOptions({
                xaxis: {
                    categories: label
                },
            });*/
            //chart.opts.labels = label;
            chart.updateOptions({
                labels: label
                
            });
            if(multiple > 1){
                var i = 0;
                chart.opts.series.forEach((dataset) => {
                    if( i < multiple){
                        dataset.data = [];
                        dataset.data = data[i++];
                        console.log(dataset.name);
                    }
                });
            }
            else if(multiple == 1){
                chart.updateSeries([{
                    data: []
                }]);
            
                chart.updateSeries([{
                    data: data
                }]);
            }

            /*if(xscale === 'day'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            //text: moment(dateopt).format('DD MMMM').toString(),
                            text: moment(dateopt[0]).format('DD MMMM YYYY').toString(),
                        }
                    },
                    tooltip: {
                        x: {
                            formatter: function (val, timestamp) {
                                return moment(new Date(val)).format("DD MMM YYYY HH:mm:ss")
                            }
                        }
                    }
                });
            }
            else if( xscale === 'month'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            text: moment(dateopt[0]).format('DD MMMM YYYY').toString() + ' - ' + moment(dateopt[1]).format('DD MMMM YYYY').toString(),
                        }
                    },
                    tooltip: {
                        x: {
                            formatter: function (val, timestamp) {
                                return moment(new Date(val)).format("DD MMM YYYY")
                            }
                        }
                    }
                });
            }*/

            if(xscale === 'day'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            //text: moment(dateopt).format('DD MMMM').toString(),
                            text: moment(dateopt[0]).format('DD MMMM YYYY').toString() + ' - ' + moment(dateopt[1]).format('DD MMMM YYYY').toString(),
                        }
                    },
                });
            }
            else if( xscale === 'month'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            text: moment(dateopt[0]).format('MMMM YYYY').toString() + ' - ' + moment(dateopt[1]).format('MMMM YYYY').toString(),
                        }
                    },
                });
            }
            //console.log(chart.options.scales.xAxes[0].scaleLabel.labelString);
            //preloaderChart(id, false);
            //chart.render();
        }    
        function displayPieNewData(chart, label, data, dateopt, multiple, xscale){
            //chart.data.labels = [];
            chart.updateOptions({
                xaxis: {
                    categories: []
                },
            });
            /*chart.updateOptions({
                xaxis: {
                    categories: label
                },
            });*/
            //chart.opts.labels = label;
            /*chart.updateOptions({
                labels: label
                
            });*/
            chart.updateOptions({
                labels: label
                
            });

            {# if(multiple > 1){
                var i = 0;
                data.forEach(function (item, index) {
                    chart.data.series.push(item);
                });
                /*chart.opts.series.forEach((dataset) => {
                    if( i < multiple){
                        dataset.data = [];
                        dataset.data = data[i++];
                        //this.data.series.push(response.data[i].value);
                        //this.data.chartOptions.labels.push(response.data[i].key);
                        //console.log(dataset.name);
                    }
                });*/
            }
            else if(multiple == 1){
                chart.updateSeries([{
                    data: []
                }]);
            
                chart.data.series.push(data);
                
                /*chart.updateSeries([{
                    data: data
                }]);*/
            }
            if(xscale === 'day'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            //text: moment(dateopt).format('DD MMMM').toString(),
                            text: moment(dateopt[0]).format('DD MMMM YYYY').toString() + ' - ' + moment(dateopt[1]).format('DD MMMM YYYY').toString(),
                        }
                    },
                });
            }
            else if( xscale === 'month'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            text: moment(dateopt[0]).format('MMMM YYYY').toString() + ' - ' + moment(dateopt[1]).format('MMMM YYYY').toString(),
                        }
                    },
                });
            } #}
            if(multiple > 1){
                var i = 0;
                chart.opts.series.forEach((dataset) => {
                    if( i < multiple){
                        dataset.data = [];
                        dataset.data = data[i++];
                        console.log(dataset.name);
                    }
                });
            }
            else if(multiple == 1){
                chart.updateSeries([{
                    data: []
                }]);
            
                chart.updateSeries([{
                    data: data
                }]);
            }
            if(xscale === 'day'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            //text: moment(dateopt).format('DD MMMM').toString(),
                            text: moment(dateopt[0]).format('DD MMMM YYYY').toString() + ' - ' + moment(dateopt[1]).format('DD MMMM YYYY').toString(),
                        }
                    },
                });
            }
            else if( xscale === 'month'){
                chart.updateOptions({
                    xaxis: {
                        title: {
                            text: moment(dateopt[0]).format('MMMM YYYY').toString() + ' - ' + moment(dateopt[1]).format('MMMM YYYY').toString(),
                        }
                    },
                });
            }
            //console.log(chart.options.scales.xAxes[0].scaleLabel.labelString);
            //preloaderChart(id, false);
            //chart.render();
        }            
        function updateDonutChart(chart, label, data) {
            chart.updateOptions({labels: label});
            chart.updateSeries(newDataSeries(chart, data));
        }
        function newDataSeries(chart, data) {
            var i = 0;
            return chart.w.globals.series.map(function () {
                return data[i++];
            });
        }
        function updateDashboard(date){
            
            $data = JSON.stringify({
                "startDate": startDate + ' 00:00:00',
                "endDate": endDate + ' 23:59:59', 
                {# "productionIds":{{smartModsProduction}}, #}
                "zoneId": {{zone.id}},
            });
            
            swal.queue([{
                title: 'The graphs will be updated for the date range :',
                confirmButtonText: 'Confirm',
                text: 'From ' + startDate + ' To ' + endDate,
                showCancelButton: true,
                showLoaderOnConfirm: true,
                confirmButtonClass: 'btn btn-primary',
                cancelButtonClass: 'btn btn-danger ml-2',
                preConfirm: function () {
                    return new Promise(function (resolve) { 
                        
                        $.ajax({
                            type: "POST", // method type
                            contentType: "application/json; charset=utf-8",
                            url: _url, // /Target function that will be return result
                            data: $data, // parameter pass data is parameter name param is value
                            dataType: "json",
                            timeout: 120000, // 64241
                            success: function (result) {
                                // $('.fa-sync').removeClass('fa-spin');
                                console.log(result);
                                
                                swal({
                                    type: 'success', 
                                    title: 'The graphs have been updated !',
                                    // html: 'Submitted email: ' + email
                                });
                                setTimeout(function () {
                                    resolve()
                                }, 2000);
                                if( Object.keys(result).length > 0 ){
                                    var dateLabel = Object.values(result['date']);
                                    console.log(result);
                                    console.log(Object.values(result['PieActiveEnergy']));
                                    {% for smartMod in zone.smartMods %}
                                        {% if smartMod.modType ==  'Load Meter' %}
                                        $('#smax_{{smartMod.id}}').text(Object.values(result['Smax'])[{{loop.index0}}])
                                        $('#fp_{{smartMod.id}}').text(Object.values(result['FP'])[{{loop.index0}}])
                                        {% endif %}
                                    {% endfor %}
                                    /*Object.values(result['Smax']).forEach(function (item, index) {
                                        var id = '#smax_' + index;
                                        console.log(item);
                                        $(id).text(item)
                                    });
                                    Object.values(result['Smax']).forEach(function (item, index) {
                                        var id  = '#fp_' + index;
                                        console.log(id);
                                        $(id).text(item)
                                    });*/
                                    /*$.each(Object.values(result['Smax']) , function( key, value ) {
                                        $('#smax_' + key).text(value)
                                    });
                                    $.each( Object.values(result['FP']), function( key, value ) {
                                        $('#fp_' + key).text(value)
                                    }); */           
                                     
                                    //displayPieNewData(ActiveEnergy_Piechart, dateLabel, Object.values(result['PieActiveEnergy']), [startDate, endDate], {{ zone.smartMods|length }}, 'day');
                                    //displayPieNewData(ReactiveEnergy_Piechart, dateLabel, Object.values(result['PieReactiveEnergy']), [startDate, endDate], {{ zone.smartMods|length }}, 'day');
                                    
                                    
                                    {% if zone.type == 'PUE Calculation' %}     
                                    $("#instPUE").text(result['InstantPUE']);
                                    //$("#intPUE").text(result['IntervalPUE']);
                                    //console.log(Object.values(result['climateDate']));
                                    displayNewData(Mixed_Pue_Power_Linechart, dateLabel, Object.values(result['PUE']), [startDate, endDate], 3, 'day');
                                    displayNewData(Mixed_Climate_Linechart, Object.values(result['climateDate']), Object.values(result['MixedClimate']), [startDate, endDate], 4, 'day');
                                    displayNewData(Mixed_Pue_Energy_Linechart, dateLabel, Object.values(result['MixedEnergy']), [startDate, endDate], 3, 'day');
                                    {% endif %}

                                    var dataArray = [{% for smartMod in zone.smartMods %}
                                        {% if smartMod.modType ==  'Load Meter' %}parseFloat(Object.values(result['PieActiveEnergy'])[{{loop.index0}}]){% if loop.last == false %},{% endif %}{% endif %}
                                        {% endfor %}
                                    ];
                                    updateDonutChart(ActiveEnergy_Piechart, [{% for smartMod in zone.smartMods %}
                                        {% if smartMod.modType ==  'Load Meter' %}String("{{smartMod.name}} : " + parseFloat(Object.values(result['PieActiveEnergy'])[{{loop.index0}}]) + " kWh"){% if loop.last == false %},{% endif %}{% endif %}
                                        {% endfor %}
                                    ], dataArray);
                                    dataArray = [{% for smartMod in zone.smartMods %}
                                        {% if smartMod.modType ==  'Load Meter' %}parseFloat(Object.values(result['PieReactiveEnergy'])[{{loop.index0}}]){% if loop.last == false %},{% endif %}{% endif %}
                                        {% endfor %}
                                    ];
                                    updateDonutChart(ReactiveEnergy_Piechart, [{% for smartMod in zone.smartMods %}
                                        {% if smartMod.modType ==  'Load Meter' %}String("{{smartMod.name}} : " + parseFloat(Object.values(result['PieReactiveEnergy'])[{{loop.index0}}]) + " kVAR"){% if loop.last == false %},{% endif %}{% endif %}
                                        {% endfor %}
                                    ], dataArray);
                                }
                            },
                            error: function (result) {
                                // console.log("Error");
                                // console.log(result);
                                swal('Oops...', 'Something went wrong!', 'error'
                                // footer: '<a href>Why do I have this issue?</a>'
                                );
                                setTimeout(function () {
                                    resolve()
                                }, 5000);
                            }
                        });
                    })
                },
                allowOutsideClick: false
            }]);
        }
    </script>

    {# Climate params script #}
    {% if zone.type == 'PUE Calculation' %}
    <script src="/js/mqttws31.js" type="text/javascript"></script>
    <script>
        var mess = {
            From: "user",
            To: "Devices",
            Object: "Connexion Status",
            message: ""
        };

        var isConnected = false;
        var wsbroker = "192.168.10.40";//location.hostname;  //mqtt websocket enabled broker
        var wsport = 15675; // port for above 1883

        var client = new Paho.MQTT.Client(wsbroker, wsport, "/ws",
            "admin_{{app.user.id}}");

        client.onConnectionLost = function (responseObject) {
            isConnected = false;
            console.log("CONNECTION LOST - " + responseObject.errorMessage);
        };

        client.onMessageArrived = function (message) {
            console.log("RECEIVE ON " + message.destinationName + " PAYLOAD " + message.payloadString);
            //print_first(message.payloadString);
            var result;
            var parse = true;
            try {
                result = JSON.parse(message.payloadString);
            } catch (e) {
                parse = false;
                console.error("Parsing error:", e);
            }

            if(parse){
                {# console.log("Received: " + message.payloadString); #}
                if (result.hasOwnProperty("Intemp")) {
                    $('#temp_indoor').text(String(result.Intemp))
                    $('#temp_outdoor').text(String(result.Outtemp))
                    $('#hum_indoor').text(String(result.Inhum))
                    $('#hum_outdoor').text(String(result.Outhum))
                    $('#update').text(String( moment( new Date(result.date) ).format("DD MMM YYYY HH:mm:ss")) )
                    
                }
            }
        };

        if (location.protocol == "https:") {
            options.useSSL = true;
        }
        //console.log("CONNECT TO " + wsbroker + ":" + wsport);
        //client.connect(options);
        //client.reconnect();
        // Try to reconnect after a few seconds
        setInterval(function () {
            if(isConnected === false){
                console.log("CONNECT TO " + wsbroker + ":" + wsport);
                client.connect({
                    timeout: 3,
                    keepAliveInterval: 30,
                    userName: "mqtt-ESP-device",
                    password: "mqtt-ESP-device",
                    onSuccess: function () {
                        isConnected = true;
                        console.log("CONNECTION SUCCESS");
                        //client.subscribe("/#", {qos: 1});
                        client.subscribe("/from/raspb/#", {qos: 1});
                    },
                    onFailure: function (message) {
                        console.log("CONNECTION FAILURE - " + message.errorMessage);
                    }
                });
            }
            else{
                //console.log("CONNECTED TO " + wsbroker + ":" + wsport);
            } 
        }, 10000);
    </script>
    {% endif %}
   
   {# Alarm panel script #}
   <script>
        var alarmTable = $('#datatable-buttons-alarm').DataTable({
            //sDom: 'lrtip',
            searching: true, 
            paging: true, 
            //info: false,
            ordering: false,
            lengthChange: false,
            //buttons: ['copy', 'excel', 'pdf', 'colvis']
            buttons: ['excel', 'pdf', 'colvis']
        });
        alarmTable.buttons().container().appendTo('#datatable-buttons-alarm_wrapper .col-md-6:eq(0)');
        
        var urlAlarmReport = "{{ path('update_alarm_report') }}";
        var start = moment().subtract(29, 'days');
        var end = moment();
        function cb(start, end) {
            $('#daterangeAlarm span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
        }
        $('#daterangeAlarm').daterangepicker({
            startDate: start,
            endDate: end,
            maxSpan: {
                "days": 31
            },
            maxDate: moment().endOf('month'),
            ranges: {
                'Today': [moment(), moment()],
                'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                'This Month': [moment().startOf('month'), moment().endOf('month')],
                'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            }
        }, cb);
        
        $('#daterangeAlarm').on('apply.daterangepicker', function (ev, picker) {
            //console.log(picker.startDate.format('YYYY-MM-DD'));
            //console.log(picker.endDate.format('YYYY-MM-DD'));
        
            startDate = picker.startDate.format('YYYY-MM-DD');
            endDate = picker.endDate.format('YYYY-MM-DD');
            
            console.log('startDate = ' + startDate);
            console.log('endDate = ' + endDate);
            updateAlarmReport();
            // block of code that runs when the click event triggers
        });
        function updateAlarmReport(){
            
            $data = JSON.stringify({
                //"selectedDate": $dat,
                "startDate": startDate + ' 00:00:00',
                "endDate": endDate + ' 23:59:59',
                //"type": "zone",
                {# "id":{{smartMod.id ?? 0}}, #}
                "zoneId": {{zone.id}},
            });
            // Danger
            swal.queue([{
                title: 'The report will be updated for the date range :',
                confirmButtonText: 'Confirm',
                text: 'From ' + startDate + ' To ' + endDate,
                showCancelButton: true,
                showLoaderOnConfirm: true,
                confirmButtonClass: 'btn btn-primary',
                cancelButtonClass: 'btn btn-danger ml-2',
                preConfirm: function () {
                    return new Promise(function (resolve) { 
                        
                        $.ajax({
                            type: "POST", // method type
                            contentType: "application/json; charset=utf-8",
                            url: urlAlarmReport, // /Target function that will be return result
                            data: $data, // parameter pass data is parameter name param is value
                            dataType: "json",
                            timeout: 120000, // 64241
                            success: function (result) {
                                // $('.fa-sync').removeClass('fa-spin');
                                console.log(result);
                                
                                swal({
                                    type: 'success', 
                                    title: 'The report have been updated !',
                                    // html: 'Submitted email: ' + email
                                });
                                setTimeout(function () {
                                    resolve()
                                }, 2000);
                                if( Object.keys(result).length > 0 ){
                                    //var dateLabel = Object.values(result['date']);
                                    //console.log(Object.values(result['CourbeCroisé']));
                                    //console.log(result);
                                    {# console.log(Object.values(result['SymI']));
                                    console.log(Object.values(result['SymV'])); #}
                                                              
                                    
                                }
                            },
                            error: function (result) {
                                // console.log("Error");
                                // console.log(result);
                                swal('Oops...', 'Something went wrong!', 'error'
                                // footer: '<a href>Why do I have this issue?</a>'
                                );
                                setTimeout(function () {
                                    resolve()
                                }, 5000);
                            }
                        });
                    })
                },
                allowOutsideClick: false
            }]);
        }
   </script>
   <script>
        
   </script>
{% endblock %}